# 系统配置要求

本文档详细说明运行小傻瓜聊天工具所需的系统配置要求。

## 1. Windows 系统要求

### 1.1 硬件配置

| 配置项 | 最低配置 | 推荐配置 |
|--------|----------|----------|
| 操作系统 | Windows 10 (1909+) / Windows 11 | Windows 11 23H2+ |
| 处理器 | Intel Core i3 / AMD Ryzen 3 (64位) | Intel Core i5 / AMD Ryzen 5 或更高 |
| 内存 (RAM) | 4 GB | 8 GB 或更高 |
| 磁盘空间 | 2 GB (仅网关) | 5 GB (含浏览器、缓存和数据) |
| 网络 | 宽带互联网连接 | 稳定的宽带连接 |

### 1.2 依赖软件

| 软件 | 版本要求 | 用途 |
|------|----------|------|
| Node.js | >= 22.12.0 | 运行时环境 |
| pnpm | >= 10.23.0 | 包管理器 |
| Git | >= 2.30 | 源码管理 |
| Python | >= 3.10 | 原生模块编译 |
| Visual Studio Build Tools | 2022 | 编译原生模块 (node-pty, sqlite-vec, sharp) |
| Visual C++ Redistributable | 2015-2022 | 运行时依赖 |

### 1.3 安装依赖命令

```powershell
# 安装 Node.js (使用 nvm-windows)
nvm install 22.12.0
nvm use 22.12.0

# 安装 pnpm
npm install -g pnpm@10.23.0

# 安装 Python (通过 Microsoft Store 或官网)
# 安装 Visual Studio Build Tools (包含 C++ 工作负载)
# 下载地址: https://visualstudio.microsoft.com/visual-cpp-build-tools/
```

### 1.4 磁盘空间估算

| 组件 | 空间需求 |
|------|----------|
| 核心程序 | ~500 MB |
| Node_modules | ~1.5 GB |
| 浏览器配置文件 | ~500 MB |
| 数据存储 (SQLite) | ~100 MB |
| 日志文件 | ~200 MB |
| 缓存 | ~200 MB |
| **总计** | **~3 GB** |

---

## 2. macOS 系统要求

### 2.1 硬件配置

| 配置项 | 最低配置 | 推荐配置 |
|--------|----------|----------|
| 操作系统 | macOS 15.0 (Sequoia) | macOS 15.2+ |
| 处理器 | Apple Silicon (M1) 或 Intel Core i5 | Apple Silicon M2+ |
| 内存 (RAM) | 8 GB | 16 GB 或更高 |
| 磁盘空间 | 3 GB | 6 GB (含 Xcode 和开发工具) |
| 网络 | 宽带互联网连接 | 稳定的宽带连接 |

### 2.2 开发工具要求

| 工具 | 版本要求 | 用途 |
|------|----------|------|
| Xcode | >= 16.0 | iOS/macOS 应用构建 |
| Swift | >= 6.0 | 应用开发 |
| Command Line Tools | 最新版 | 编译工具链 |
| Homebrew | 最新版 | 包管理 |

### 2.3 安装依赖命令

```bash
# 安装 Homebrew (如未安装)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Node.js
brew install node@22

# 安装 pnpm
npm install -g pnpm@10.23.0

# 安装 Xcode Command Line Tools
xcode-select --install

# 安装 Swift 工具
brew install swiftformat swiftlint
```

### 2.4 签名和公证要求

| 项目 | 要求 |
|------|------|
| Apple Developer 账号 | 需要 ($99/年) 用于分发 |
| 代码签名证书 | Apple Development / Distribution |
| 公证 (Notarization) | 需要 (macOS 10.15+ 强制要求) |
| Bundle Identifier | 格式: `ai.openclaw.macos` |

**签名配置示例:**

```bash
# 开发签名
codesign --sign "Apple Development" --force --deep OpenClaw.app

# 分发签名
codesign --sign "Developer ID Application" --force --deep --options runtime OpenClaw.app

# 公证
xcrun notarytool submit OpenClaw.dmg --apple-id "your@email.com" --team-id "TEAM_ID" --wait
```

---

## 3. Android 系统要求

### 3.1 设备要求

| 配置项 | 最低配置 | 推荐配置 |
|--------|----------|----------|
| Android 版本 | API 31 (Android 12) | API 36 (Android 16) |
| 存储空间 | 100 MB (应用) + 200 MB (数据) | 500 MB 可用空间 |
| 内存 (RAM) | 3 GB | 4 GB 或更高 |
| 处理器 | ARM64 (arm64-v8a) | ARM64 中高端芯片 |
| 网络 | WiFi / 移动数据 | 稳定的网络连接 |

### 3.2 开发环境要求

| 工具 | 版本要求 |
|------|----------|
| Android Studio | 最新稳定版 |
| Android SDK | API 36 (compileSdk) |
| Gradle | 8.13.2 |
| Kotlin | 2.2.21 |
| Java | 17 |

### 3.3 权限需求

| 权限 | 用途 | 必需 |
|------|------|------|
| `INTERNET` | 网络通信 | 是 |
| `ACCESS_NETWORK_STATE` | 网络状态检测 | 是 |
| `FOREGROUND_SERVICE` | 后台服务运行 | 是 |
| `FOREGROUND_SERVICE_DATA_SYNC` | 数据同步服务 | 是 |
| `FOREGROUND_SERVICE_MICROPHONE` | 语音唤醒 | 否 |
| `POST_NOTIFICATIONS` | 通知显示 (Android 13+) | 是 |
| `CAMERA` | 拍照/录像 | 否 |
| `RECORD_AUDIO` | 录音 | 否 |
| `ACCESS_FINE_LOCATION` | 精确位置 (发现网关) | 否 |
| `NEARBY_WIFI_DEVICES` | 附近 WiFi 设备 (Android 13+) | 否 |
| `SEND_SMS` | 发送短信 | 否 |

### 3.4 构建命令

```bash
cd apps/android

# 构建 Debug APK
./gradlew :app:assembleDebug

# 安装到设备
./gradlew :app:installDebug

# 运行测试
./gradlew :app:testDebugUnitTest
```

---

## 4. iOS 系统要求

### 4.1 设备要求

| 配置项 | 最低配置 | 推荐配置 |
|--------|----------|----------|
| iOS 版本 | iOS 18.0 | iOS 18.2+ |
| 设备 | iPhone XS / iPad (第 8 代) 或更新 | iPhone 15 / iPad Pro 或更新 |
| 存储空间 | 150 MB (应用) + 200 MB (数据) | 500 MB 可用空间 |
| 网络 | WiFi / 移动数据 | 稳定的网络连接 |

### 4.2 开发环境要求

| 工具 | 版本要求 |
|------|----------|
| Xcode | >= 16.0 |
| Swift | >= 6.0 |
| Swift Tools | >= 6.2 |
| macOS | >= 15.0 (Sequoia) |

### 4.3 构建命令

```bash
cd apps/ios

# 生成 Xcode 项目
xcodegen generate

# 构建
xcodebuild -project OpenClaw.xcodeproj -scheme OpenClaw -destination "platform=iOS Simulator,name=iPhone 17" -configuration Debug build

# 运行 (模拟器)
xcrun simctl boot "iPhone 17"
xcrun simctl launch booted ai.openclaw.ios

# 打开 Xcode
open OpenClaw.xcodeproj
```

---

## 5. 通用网络要求

### 5.1 端口使用

| 端口 | 服务 | 协议 | 说明 |
|------|------|------|------|
| 18789 | Gateway WebSocket | WS/WSS | 核心网关端口 |
| 18790 | Bridge | TCP | 桥接服务 |
| 18791 | Browser Control | HTTP | 浏览器控制服务器 |
| 18793 | Canvas Host | HTTP | Canvas 渲染服务 |
| 18800-18899 | Browser CDP | TCP | Chrome DevTools Protocol |

### 5.2 网络配置

| 配置项 | 要求 |
|--------|------|
| 出站连接 | 允许访问互联网 (API 调用) |
| 本地网络 | 允许 Bonjour/mDNS 发现 ( `_openclaw-gw._tcp` ) |
| WebSocket | 支持 WebSocket 连接 |
| 防火墙 | 开放 18789-18899 端口范围 (本地使用) |

### 5.3 远程访问配置

如需远程访问网关，可使用以下方式:

| 方式 | 配置 |
|------|------|
| Tailscale Serve/Funnel | `tailscale serve --https=443 localhost:18789` |
| SSH 隧道 | `ssh -L 18789:localhost:18789 user@remote-host` |
| 反向代理 | Nginx / Caddy 配置 SSL 终止 |

---

## 6. 存储需求估算

### 6.1 按使用场景估算

| 使用场景 | 存储需求 | 说明 |
|----------|----------|------|
| 轻量使用 | 2-3 GB | 仅网关，少量对话 |
| 正常使用 | 5-8 GB | 网关 + 浏览器 + 中等数据量 |
| 重度使用 | 10-15 GB | 多通道 + 大量媒体 + 长期历史 |
| 开发环境 | 15-20 GB | 完整源码 + 构建产物 + 多平台 |

### 6.2 数据存储明细

| 数据类型 | 默认位置 | 估算大小 |
|----------|----------|----------|
| 配置文件 | `~/.config/openclaw/` | ~10 MB |
| 状态数据 | `~/.local/state/openclaw/` | ~50 MB |
| SQLite 数据库 | `~/.local/state/openclaw/` | ~100 MB |
| 浏览器配置 | `~/.config/openclaw/browser/` | ~500 MB |
| 日志文件 | `~/.local/state/openclaw/logs/` | ~200 MB |
| 临时文件 | `/tmp/openclaw/` | ~100 MB |
| 缓存 | `~/.cache/openclaw/` | ~200 MB |

### 6.3 清理命令

```bash
# 清理日志 (保留最近 7 天)
find ~/.local/state/openclaw/logs -name "*.log" -mtime +7 -delete

# 清理临时文件
rm -rf /tmp/openclaw/*

# 清理浏览器缓存
rm -rf ~/.config/openclaw/browser/*/Default/Cache/*

# 压缩数据库 (如使用 SQLite)
sqlite3 ~/.local/state/openclaw/data.db "VACUUM;"
```

---

## 7. 原生模块编译要求

### 7.1 Sharp (图像处理)

| 平台 | 要求 |
|------|------|
| Windows | Visual Studio Build Tools 2022, Python 3.10+ |
| macOS | Xcode Command Line Tools |
| Linux | build-essential, libvips-dev |

### 7.2 SQLite / sqlite-vec

| 平台 | 要求 |
|------|------|
| Windows | Visual Studio Build Tools 2022 |
| macOS | Xcode Command Line Tools |
| Linux | gcc, make, sqlite3-dev |

### 7.3 node-pty (终端)

| 平台 | 要求 |
|------|------|
| Windows | Visual Studio Build Tools 2022, Python 3.10+ |
| macOS | Xcode Command Line Tools |
| Linux | build-essential, python3 |

### 7.4 @napi-rs/canvas

| 平台 | 要求 |
|------|------|
| Windows | 预编译二进制可用 |
| macOS | 预编译二进制可用 |
| Linux | 可能需要系统依赖 (cairo, pango) |

---

## 8. 性能优化建议

### 8.1 Node.js 内存配置

```bash
# 增加内存限制 (默认 4GB 可能不够)
export NODE_OPTIONS="--max-old-space-size=8192"

# 启动网关
openclaw gateway --port 18789 --verbose
```

### 8.2 数据库优化

```bash
# 定期维护 SQLite 数据库
sqlite3 ~/.local/state/openclaw/data.db <<EOF
PRAGMA optimize;
PRAGMA vacuum;
EOF
```

### 8.3 系统级优化

| 优化项 | 建议 |
|--------|------|
| 文件描述符 | Linux/macOS: `ulimit -n 4096` |
| 进程数 | Linux: `ulimit -u 2048` |
| 虚拟内存 | Windows: 确保页面文件大小 >= 8GB |
| 防病毒 | Windows Defender 排除项目目录 |

---

## 9. 故障排除

### 9.1 常见编译错误

| 错误 | 解决方案 |
|------|----------|
| `gyp ERR!` | 安装 Python 和 Visual Studio Build Tools |
| `node-gyp rebuild failed` | 清除缓存: `npm cache clean --force` |
| `sharp` 安装失败 | 设置: `npm config set sharp_binary_host ...` |
| `sqlite-vec` 编译失败 | 确保 C++ 编译器可用 |

### 9.2 端口冲突

```bash
# 检查端口占用 (Linux/macOS)
lsof -i :18789

# 检查端口占用 (Windows)
netstat -ano | findstr :18789

# 使用自定义端口
openclaw gateway --port 8080
```

### 9.3 内存不足

```bash
# 监控内存使用
openclaw gateway --verbose 2>&1 | tee gateway.log

# 限制并发连接数
# 在配置文件中设置: gateway.maxConnections = 50
```

---

## 10. 参考链接

- [Node.js 下载](https://nodejs.org/)
- [pnpm 文档](https://pnpm.io/)
- [Visual Studio Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/)
- [Xcode 下载](https://developer.apple.com/xcode/)
- [Android Studio 下载](https://developer.android.com/studio)
- [OpenClaw 文档](https://docs.openclaw.ai)
