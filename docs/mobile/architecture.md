# Android æ¶æ„æ–‡æ¡£

> æœ¬æ–‡æ¡£è¯¦ç»†æè¿° SillyChat Android åº”ç”¨çš„æ•´ä½“æ¶æ„ã€æ¨¡å—åˆ’åˆ†å’Œæ•°æ®æµã€‚

---

## 1. æ•´ä½“æ¶æ„

### 1.1 æ¶æ„æ¦‚è§ˆ

SillyChat Android é‡‡ç”¨ **React Native + åŸç”Ÿæ¨¡å—** çš„æ··åˆæ¶æ„ï¼Œç»“åˆæ ¸å¿ƒå±‚çš„å…±äº«èƒ½åŠ›ï¼Œå®ç°è·¨å¹³å°ä»£ç å¤ç”¨ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (Application Layer)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   UI ç»„ä»¶     â”‚  â”‚   ä¸šåŠ¡é€»è¾‘    â”‚  â”‚   çŠ¶æ€ç®¡ç†    â”‚          â”‚
â”‚  â”‚  (React)     â”‚  â”‚   (Hooks)    â”‚  â”‚  (Zustand)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                 â”‚                 â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚              React Native Bridge                  â”‚          â”‚
â”‚  â”‚         (JavaScript <-> Native é€šä¿¡)              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¡¥æ¥å±‚ (Bridge Layer)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  TurboModules â”‚  â”‚   JSI æ¥å£    â”‚  â”‚  NativeModulesâ”‚          â”‚
â”‚  â”‚  (æ–°æ¶æ„)     â”‚  â”‚  (åŒæ­¥è°ƒç”¨)   â”‚  â”‚  (æ—§æ¶æ„)     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åŸç”Ÿå±‚ (Native Layer)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  é€šçŸ¥æœåŠ¡     â”‚  â”‚  åå°ä»»åŠ¡     â”‚  â”‚  æœ¬åœ°å­˜å‚¨     â”‚          â”‚
â”‚  â”‚Notification â”‚  â”‚  Background  â”‚  â”‚   Storage    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  åŠ å¯†æ¨¡å—     â”‚  â”‚  æ–‡ä»¶ç®¡ç†     â”‚  â”‚  è®¾å¤‡ä¿¡æ¯     â”‚          â”‚
â”‚  â”‚  Encryption  â”‚  â”‚    File      â”‚  â”‚   Device     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚  JNI / AIDL
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒå±‚ (Core Layer)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ç½‘å…³å®¢æˆ·ç«¯   â”‚  â”‚  åè®®å¤„ç†     â”‚  â”‚  æ•°æ®åºåˆ—åŒ–   â”‚          â”‚
â”‚  â”‚   Gateway    â”‚  â”‚   Protocol   â”‚  â”‚ Serializationâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  æ¶ˆæ¯é˜Ÿåˆ—     â”‚  â”‚  çŠ¶æ€æœº       â”‚  â”‚  é”™è¯¯å¤„ç†     â”‚          â”‚
â”‚  â”‚    Queue     â”‚  â”‚ State Machineâ”‚  â”‚ Error Handlerâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|----------|------|
| å‰ç«¯æ¡†æ¶ | React Native 0.73+ | è·¨å¹³å° UI æ¡†æ¶ |
| è¯­è¨€ | TypeScript 5.x | ç±»å‹å®‰å…¨ |
| çŠ¶æ€ç®¡ç† | Zustand 4.x | è½»é‡çº§çŠ¶æ€ç®¡ç† |
| å¯¼èˆª | React Navigation 6.x | é¡µé¢å¯¼èˆª |
| ç½‘ç»œ | Axios + WebSocket | HTTP å’Œå®æ—¶é€šä¿¡ |
| å­˜å‚¨ | MMKV + SQLite | é«˜æ€§èƒ½é”®å€¼å’Œå…³ç³»å­˜å‚¨ |
| åŸç”Ÿè¯­è¨€ | Kotlin (Android) | åŸç”Ÿæ¨¡å—å¼€å‘ |
| æ ¸å¿ƒå±‚ | Rust/C++ (å…±äº«åº“) | è·¨å¹³å°æ ¸å¿ƒé€»è¾‘ |

---

## 2. æ¨¡å—åˆ’åˆ†

### 2.1 æ¨¡å—ç»“æ„

```
SillyChat Mobile
â”œâ”€â”€ ğŸ“± Presentation Layer (å±•ç¤ºå±‚)
â”‚   â”œâ”€â”€ Components          # UI ç»„ä»¶
â”‚   â”œâ”€â”€ Screens            # é¡µé¢
â”‚   â”œâ”€â”€ Navigation         # å¯¼èˆª
â”‚   â””â”€â”€ Theme              # ä¸»é¢˜
â”‚
â”œâ”€â”€ ğŸ§  Business Layer (ä¸šåŠ¡å±‚)
â”‚   â”œâ”€â”€ Hooks              # ä¸šåŠ¡é€»è¾‘ Hooks
â”‚   â”œâ”€â”€ Services           # ä¸šåŠ¡æœåŠ¡
â”‚   â””â”€â”€ Store              # çŠ¶æ€ç®¡ç†
â”‚
â”œâ”€â”€ ğŸ”Œ Data Layer (æ•°æ®å±‚)
â”‚   â”œâ”€â”€ API                # ç½‘ç»œè¯·æ±‚
â”‚   â”œâ”€â”€ Storage            # æœ¬åœ°å­˜å‚¨
â”‚   â””â”€â”€ Gateway            # ç½‘å…³è¿æ¥
â”‚
â”œâ”€â”€ ğŸ”§ Native Layer (åŸç”Ÿå±‚)
â”‚   â”œâ”€â”€ Notification       # é€šçŸ¥æ¨¡å—
â”‚   â”œâ”€â”€ Background         # åå°ä»»åŠ¡
â”‚   â”œâ”€â”€ Security           # å®‰å…¨æ¨¡å—
â”‚   â””â”€â”€ Device             # è®¾å¤‡ä¿¡æ¯
â”‚
â””â”€â”€ âš™ï¸ Core Layer (æ ¸å¿ƒå±‚)
    â”œâ”€â”€ Protocol           # é€šä¿¡åè®®
    â”œâ”€â”€ Crypto             # åŠ å¯†ç®—æ³•
    â””â”€â”€ Utils              # å·¥å…·å‡½æ•°
```

### 2.2 æ¨¡å—èŒè´£

#### å±•ç¤ºå±‚ (Presentation Layer)

```typescript
// èŒè´£: è´Ÿè´£ UI æ¸²æŸ“å’Œç”¨æˆ·äº¤äº’
// ç‰¹ç‚¹: æ— ä¸šåŠ¡é€»è¾‘ï¼Œçº¯å±•ç¤º

// ç¤ºä¾‹: ChatScreen.tsx
export const ChatScreen: React.FC = () => {
  const { messages, sendMessage } = useChat();
  const { user } = useAuth();

  return (
    <View style={styles.container}>
      <MessageList messages={messages} />
      <InputBar onSend={sendMessage} />
    </View>
  );
};
```

#### ä¸šåŠ¡å±‚ (Business Layer)

```typescript
// èŒè´£: å°è£…ä¸šåŠ¡é€»è¾‘
// ç‰¹ç‚¹: å¯å¤ç”¨ï¼Œä¸ UI è§£è€¦

// ç¤ºä¾‹: useChat.ts
export const useChat = () => {
  const [messages, setMessages] = useState<Message[]>([]);
  const gateway = useGateway();

  const sendMessage = useCallback(async (content: string) => {
    const message = await gateway.sendMessage(content);
    setMessages((prev) => [...prev, message]);
  }, [gateway]);

  return { messages, sendMessage };
};
```

#### æ•°æ®å±‚ (Data Layer)

```typescript
// èŒè´£: æ•°æ®è·å–å’ŒæŒä¹…åŒ–
// ç‰¹ç‚¹: æŠ½è±¡æ•°æ®æºï¼Œæ”¯æŒç¼“å­˜

// ç¤ºä¾‹: api/client.ts
export class ApiClient {
  async request<T>(config: RequestConfig): Promise<T> {
    // 1. æ£€æŸ¥ç¼“å­˜
    const cached = await this.cache.get(config.url);
    if (cached) return cached;

    // 2. ç½‘ç»œè¯·æ±‚
    const response = await axios.request(config);

    // 3. æ›´æ–°ç¼“å­˜
    await this.cache.set(config.url, response.data);

    return response.data;
  }
}
```

---

## 3. æ•°æ®æµå›¾

### 3.1 æ¶ˆæ¯å‘é€æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¾“å…¥   â”‚â”€â”€â”€â”€â–¶â”‚  ä¸šåŠ¡å±‚å¤„ç†  â”‚â”€â”€â”€â”€â–¶â”‚  çŠ¶æ€æ›´æ–°   â”‚
â”‚  Input Bar  â”‚     â”‚  useChat()  â”‚     â”‚  Zustand   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚
                           â–¼                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ç½‘å…³å‘é€   â”‚     â”‚  UI é‡æ¸²æŸ“  â”‚
                    â”‚  Gateway   â”‚     â”‚  React     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æ ¸å¿ƒå±‚åŠ å¯† â”‚
                    â”‚  Core Cryptoâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æœåŠ¡å™¨     â”‚
                    â”‚  Server    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¶ˆæ¯æ¥æ”¶æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœåŠ¡å™¨æ¨é€ â”‚â”€â”€â”€â”€â–¶â”‚  æ ¸å¿ƒå±‚è§£å¯† â”‚â”€â”€â”€â”€â–¶â”‚  ç½‘å…³åˆ†å‘   â”‚
â”‚   Server   â”‚     â”‚ Core Decryptâ”‚     â”‚  Gateway   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æœ¬åœ°å­˜å‚¨   â”‚
                    â”‚  SQLite    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  çŠ¶æ€æ›´æ–°   â”‚ â”‚  é€šçŸ¥æ˜¾ç¤º   â”‚ â”‚  åå°å¤„ç†   â”‚
    â”‚  Zustand   â”‚ â”‚ Notificationâ”‚ â”‚ Background â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  UI é‡æ¸²æŸ“  â”‚
    â”‚  React     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 çŠ¶æ€ç®¡ç†æµç¨‹

```typescript
// å…¨å±€çŠ¶æ€æµ
// 1. ç”¨æˆ·æ“ä½œè§¦å‘ Action
const sendMessage = async (content: string) => {
  // 2. è°ƒç”¨ Service å±‚
  const message = await messageService.create(content);

  // 3. æ›´æ–° Store
  useChatStore.getState().addMessage(message);

  // 4. æŒä¹…åŒ–åˆ°æœ¬åœ°
  await storage.saveMessage(message);
};

// Store è®¢é˜…æœºåˆ¶
// ç»„ä»¶è‡ªåŠ¨å“åº”çŠ¶æ€å˜åŒ–
const messages = useChatStore((state) => state.messages);
```

---

## 4. ä¸æ ¸å¿ƒå±‚é›†æˆ

### 4.1 æ ¸å¿ƒå±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ¸å¿ƒå±‚ (Core Layer)                       â”‚
â”‚                     Rust å…±äº«åº“                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Gateway    â”‚  â”‚   Crypto     â”‚  â”‚   Protocol   â”‚      â”‚
â”‚  â”‚   Client     â”‚  â”‚   Module     â”‚  â”‚   Handler    â”‚      â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚      â”‚
â”‚  â”‚ - è¿æ¥ç®¡ç†    â”‚  â”‚ - ç«¯åˆ°ç«¯åŠ å¯†  â”‚  â”‚ - æ¶ˆæ¯åºåˆ—åŒ–  â”‚      â”‚
â”‚  â”‚ - å¿ƒè·³æœºåˆ¶    â”‚  â”‚ - å¯†é’¥äº¤æ¢    â”‚  â”‚ - åè®®è§£æ    â”‚      â”‚
â”‚  â”‚ - é‡è¿é€»è¾‘    â”‚  â”‚ - ç­¾åéªŒè¯    â”‚  â”‚ - ç‰ˆæœ¬å…¼å®¹    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                 â”‚                 â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              JNI / JSI ç»‘å®šå±‚                      â”‚      â”‚
â”‚  â”‚         (Rust <-> Kotlin <-> JS)                 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 é›†æˆæ–¹å¼

#### JSI (JavaScript Interface) - æ–°æ¶æ„

```typescript
// 1. å®šä¹‰ TurboModule è§„èŒƒ
// NativeSillyChatCore.ts
import { TurboModule, TurboModuleRegistry } from 'react-native';

export interface Spec extends TurboModule {
  // ç½‘å…³è¿æ¥
  connect(host: string, port: number): Promise<void>;
  disconnect(): Promise<void>;

  // æ¶ˆæ¯å‘é€
  sendMessage(message: string): Promise<string>;

  // åŠ å¯†æ“ä½œ
  encrypt(data: string, keyId: string): Promise<string>;
  decrypt(data: string, keyId: string): Promise<string>;

  // äº‹ä»¶ç›‘å¬
  addListener(eventName: string): void;
  removeListeners(count: number): void;
}

export default TurboModuleRegistry.get<Spec>('SillyChatCore');
```

```kotlin
// 2. Kotlin åŸç”Ÿå®ç°
// android/app/src/main/java/com/sillychat/core/SillyChatCoreModule.kt

@ReactModule(name = "SillyChatCore")
class SillyChatCoreModule(reactContext: ReactApplicationContext) :
    NativeSillyChatCoreSpec(reactContext) {

    private val coreLib = CoreLibrary()

    @ReactMethod
    override fun connect(host: String, port: Int, promise: Promise) {
        try {
            coreLib.connect(host, port)
            promise.resolve(null)
        } catch (e: Exception) {
            promise.reject("CONNECT_ERROR", e.message)
        }
    }

    @ReactMethod
    override fun sendMessage(message: String, promise: Promise) {
        try {
            val result = coreLib.sendMessage(message)
            promise.resolve(result)
        } catch (e: Exception) {
            promise.reject("SEND_ERROR", e.message)
        }
    }

    // äº‹ä»¶å‘é€
    fun emitEvent(eventName: String, data: WritableMap) {
        reactApplicationContext
            .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter::class.java)
            .emit(eventName, data)
    }
}
```

```rust
// 3. Rust æ ¸å¿ƒå®ç°
// core/src/lib.rs

use std::sync::Arc;
use tokio::sync::RwLock;

pub struct CoreLibrary {
    gateway: Arc<RwLock<GatewayClient>>,
    crypto: Arc<CryptoEngine>,
}

impl CoreLibrary {
    pub fn new() -> Self {
        Self {
            gateway: Arc::new(RwLock::new(GatewayClient::new())),
            crypto: Arc::new(CryptoEngine::new()),
        }
    }

    pub fn connect(&self, host: &str, port: u16) -> Result<(), CoreError> {
        let runtime = tokio::runtime::Runtime::new()?;
        runtime.block_on(async {
            let mut gateway = self.gateway.write().await;
            gateway.connect(host, port).await
        })
    }

    pub fn send_message(&self, message: &str) -> Result<String, CoreError> {
        // åŠ å¯†æ¶ˆæ¯
        let encrypted = self.crypto.encrypt(message)?;

        // å‘é€
        let runtime = tokio::runtime::Runtime::new()?;
        runtime.block_on(async {
            let gateway = self.gateway.read().await;
            gateway.send(encrypted).await
        })
    }
}

// JNI å¯¼å‡º
#[no_mangle]
pub extern "C" fn Java_com_sillychat_core_CoreLibrary_nativeConnect(
    env: JNIEnv,
    _class: JClass,
    host: JString,
    port: jint,
) -> jboolean {
    let host: String = env.get_string(&host).unwrap().into();
    let core = CoreLibrary::new();
    match core.connect(&host, port as u16) {
        Ok(_) => 1,
        Err(_) => 0,
    }
}
```

### 4.3 æ•°æ®åºåˆ—åŒ–

```typescript
// æ¶ˆæ¯æ ¼å¼å®šä¹‰
interface WireMessage {
  version: number;      // åè®®ç‰ˆæœ¬
  type: MessageType;    // æ¶ˆæ¯ç±»å‹
  id: string;          // æ¶ˆæ¯ ID
  timestamp: number;   // æ—¶é—´æˆ³
  payload: Uint8Array; // åŠ å¯†åçš„æ•°æ®
  signature: string;   // ç­¾å
}

// åºåˆ—åŒ–æµç¨‹
const serializeMessage = (message: Message): Uint8Array => {
  // 1. è½¬æ¢ä¸º JSON
  const json = JSON.stringify(message);

  // 2. å‹ç¼©
  const compressed = zlib.deflate(json);

  // 3. åŠ å¯†
  const encrypted = core.encrypt(compressed, message.recipientKey);

  // 4. æ·»åŠ åè®®å¤´
  const wireFormat = new WireMessage({
    version: 1,
    type: message.type,
    id: message.id,
    timestamp: Date.now(),
    payload: encrypted,
    signature: core.sign(encrypted),
  });

  return wireFormat.encode();
};
```

---

## 5. å®‰å…¨æ¶æ„

### 5.1 åŠ å¯†ä½“ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åŠ å¯†æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 ä¼ è¾“å±‚åŠ å¯† (TLS 1.3)                  â”‚   â”‚
â”‚  â”‚         æœåŠ¡å™¨é€šä¿¡ + è¯ä¹¦å›ºå®š (Certificate Pinning)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 ç«¯åˆ°ç«¯åŠ å¯† (E2EE)                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ X3DH å¯†é’¥äº¤æ¢ â”‚  â”‚ Double Ratchetâ”‚  â”‚ AES-256  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ (Signalåè®®) â”‚  â”‚   (å‰å‘ä¿å¯†)  â”‚  â”‚  GCM     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 æœ¬åœ°æ•°æ®åŠ å¯†                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  SQLCipher   â”‚  â”‚  Keychain/   â”‚  â”‚ Biometricâ”‚  â”‚   â”‚
â”‚  â”‚  â”‚ (æ•°æ®åº“åŠ å¯†) â”‚  â”‚  Keystore    â”‚  â”‚  Auth    â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å¯†é’¥ç®¡ç†

```kotlin
// Android Keystore å¯†é’¥ç®¡ç†
class KeyStoreManager(context: Context) {
    private val keyStore = KeyStore.getInstance("AndroidKeyStore").apply {
        load(null)
    }

    // ç”ŸæˆåŠ å¯†å¯†é’¥ (å—ç”Ÿç‰©è¯†åˆ«ä¿æŠ¤)
    fun generateBiometricKey(alias: String): SecretKey {
        val keyGenerator = KeyGenerator.getInstance(
            KeyProperties.KEY_ALGORITHM_AES,
            "AndroidKeyStore"
        )

        val builder = KeyGenParameterSpec.Builder(
            alias,
            KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT
        )
            .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
            .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
            .setKeySize(256)
            .setUserAuthenticationRequired(true)
            .setInvalidatedByBiometricEnrollment(true)

        keyGenerator.init(builder.build())
        return keyGenerator.generateKey()
    }

    // è·å–æˆ–åˆ›å»ºå¯†é’¥
    fun getOrCreateKey(alias: String): SecretKey {
        return keyStore.getKey(alias, null) as? SecretKey
            ?: generateBiometricKey(alias)
    }
}
```

---

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 æ¸²æŸ“ä¼˜åŒ–

```typescript
// 1. ä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦é‡æ¸²æŸ“
export const MessageBubble = React.memo(
  ({ message, isOwn }: MessageBubbleProps) => {
    // ç»„ä»¶å®ç°
  },
  (prev, next) => {
    // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
    return (
      prev.message.id === next.message.id &&
      prev.message.status === next.message.status
    );
  }
);

// 2. ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—
const sortedMessages = useMemo(() => {
  return messages.sort((a, b) => a.timestamp - b.timestamp);
}, [messages]);

// 3. è™šæ‹Ÿåˆ—è¡¨å¤„ç†å¤§é‡æ•°æ®
import { FlashList } from '@shopify/flash-list';

<FlashList
  data={messages}
  renderItem={renderMessage}
  estimatedItemSize={80}
  keyExtractor={(item) => item.id}
  inverted={true}
  maintainVisibleContentPosition={{
    minIndexForVisible: 0,
  }}
/>
```

### 6.2 å†…å­˜ç®¡ç†

```typescript
// å›¾ç‰‡ç¼“å­˜ç­–ç•¥
const imageCache = new Map<string, ImageSource>();

const preloadImages = async (urls: string[]) => {
  const promises = urls.map(async (url) => {
    if (!imageCache.has(url)) {
      const source = await Image.prefetch(url);
      imageCache.set(url, source);
    }
  });
  await Promise.all(promises);
};

// æ¸…ç†ç­–ç•¥
useEffect(() => {
  return () => {
    // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
    imageCache.clear();
  };
}, []);
```

---

## 7. ç›¸å…³æ–‡æ¡£

- [å¼€å‘æŒ‡å—](./dev-guide.md) - ç¯å¢ƒæ­å»ºå’Œå¼€å‘è§„èŒƒ
- [API æ–‡æ¡£](./api-reference.md) - ç»„ä»¶å’Œ Hooks API
- [åŸç”Ÿæ¨¡å—æ–‡æ¡£](./native-modules.md) - Android åŸç”Ÿæ¨¡å—è¯¦æƒ…
- [æµ‹è¯•æŒ‡å—](./testing-guide.md) - æµ‹è¯•ç­–ç•¥å’Œæ–¹æ³•
- [å‘å¸ƒæŒ‡å—](./deployment.md) - æ‰“åŒ…å’Œå‘å¸ƒæµç¨‹
