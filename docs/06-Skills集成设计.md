# Skills æŠ€èƒ½ä¸­å¿ƒé›†æˆè®¾è®¡æ–‡æ¡£

> æœ¬æ–‡æ¡£æè¿°æŒºå‚»ç½‘ç«™ Skills æŠ€èƒ½ä¸­å¿ƒä¸èŠå¤©å·¥å…·çš„é›†æˆè®¾è®¡æ–¹æ¡ˆï¼Œå®ç°ç½‘ç«™ Skills åŒæ­¥æ‹‰å–åˆ°èŠå¤©å·¥å…·çš„ Skills é¢‘é“ã€‚

## ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#1-æ¶æ„æ¦‚è¿°)
2. [Skills æ¶æ„](#2-skills-æ¶æ„)
3. [åŒæ­¥æœºåˆ¶](#3-åŒæ­¥æœºåˆ¶)
4. [Skills é¢‘é“](#4-skills-é¢‘é“)
5. [æ‰§è¡Œç¯å¢ƒ](#5-æ‰§è¡Œç¯å¢ƒ)
6. [å®‰å…¨è€ƒè™‘](#6-å®‰å…¨è€ƒè™‘)
7. [API æ¥å£è®¾è®¡](#7-api-æ¥å£è®¾è®¡)
8. [éƒ¨ç½²ä¸è¿ç»´](#8-éƒ¨ç½²ä¸è¿ç»´)

---

## 1. æ¶æ„æ¦‚è¿°

### 1.1 é›†æˆæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Skills æŠ€èƒ½ä¸­å¿ƒé›†æˆæ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   æŒºå‚»ç½‘ç«™ Skills    â”‚         â”‚   èŠå¤©å·¥å…· Skills    â”‚               â”‚
â”‚  â”‚   Skill Center      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Skills Channel    â”‚               â”‚
â”‚  â”‚                     â”‚  åŒæ­¥    â”‚                     â”‚               â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚
â”‚  â”‚  â”‚ Skills Store  â”‚  â”‚         â”‚  â”‚ Skills Cache  â”‚  â”‚               â”‚
â”‚  â”‚  â”‚ - å…è´¹ Skills â”‚  â”‚         â”‚  â”‚ - æœ¬åœ°ç¼“å­˜    â”‚  â”‚               â”‚
â”‚  â”‚  â”‚ - å•†ç”¨ Skills â”‚  â”‚         â”‚  â”‚ - å¢é‡æ›´æ–°    â”‚  â”‚               â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚
â”‚  â”‚                     â”‚         â”‚                     â”‚               â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚
â”‚  â”‚  â”‚ Version Mgmt  â”‚  â”‚         â”‚  â”‚ Skill Runner  â”‚  â”‚               â”‚
â”‚  â”‚  â”‚ - ç‰ˆæœ¬æ§åˆ¶    â”‚  â”‚         â”‚  â”‚ - æ²™ç®±æ‰§è¡Œ    â”‚  â”‚               â”‚
â”‚  â”‚  â”‚ - ä¾èµ–è§£æ    â”‚  â”‚         â”‚  â”‚ - èµ„æºé™åˆ¶    â”‚  â”‚               â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚
â”‚  â”‚                     â”‚         â”‚                     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â–²                               â–²                            â”‚
â”‚           â”‚                               â”‚                            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                           â”‚                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚                    â”‚  Sync API   â”‚                                     â”‚
â”‚                    â”‚  åŒæ­¥ç½‘å…³    â”‚                                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ•°æ®æµå‘å›¾                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ç½‘ç«™ Skills                    åŒæ­¥æµç¨‹                  èŠå¤©å·¥å…·      â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ å‘å¸ƒ Skillâ”‚ â”€â”€â”€â”€â”€â”€â”                                   â”‚ æ£€æµ‹æ›´æ–° â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                        â”‚        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â–¼                                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ æ›´æ–°ç‰ˆæœ¬ â”‚ â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      WebSocket/Poll  â”€â”€â–º â”‚ æ‹‰å–å˜æ›´ â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ å˜æ›´æ£€æµ‹  â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                               â”‚        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                                â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ ä¸‹æ¶ Skillâ”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚ æ›´æ–°ç¼“å­˜ â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     å¢é‡åŒæ­¥                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚        â”‚
â”‚                                                          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚
â”‚                                                          â”‚ é€šçŸ¥ç”¨æˆ· â”‚  â”‚
â”‚                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Skills æ¶æ„

### 2.1 Skill å®šä¹‰æ ¼å¼

Skill é‡‡ç”¨æ ‡å‡†åŒ– YAML + Markdown æ ¼å¼å®šä¹‰ï¼š

```yaml
# ============================================
# Skill å®šä¹‰æ ¼å¼è§„èŒƒ (Skill Specification)
# ============================================

# å¿…éœ€å­—æ®µ
skill:
  # å”¯ä¸€æ ‡è¯†ç¬¦ (æ ¼å¼: domain-category-name)
  id: "tech-python-data-analysis"

  # æ˜¾ç¤ºåç§°
  name: "Python æ•°æ®åˆ†ææ¨¡æ¿"

  # ç‰ˆæœ¬å· (éµå¾ª SemVer)
  version: "1.2.0"

  # åˆ†ç±» (tech/product/design/marketing/ops)
  category: "tech"

  # ç±»å‹ (free/commercial)
  type: "free"

  # ä½œè€…ä¿¡æ¯
  author:
    id: "user_123"
    name: "å¼ ä¸‰"
    avatar: "https://cdn.sillymd.com/avatars/123.jpg"

  # æè¿°ä¿¡æ¯
  description: "æ ‡å‡†åŒ–çš„ Python æ•°æ®åˆ†ææµç¨‹æ¨¡æ¿"

  # æ ‡ç­¾
  tags:
    - "python"
    - "data-analysis"
    - "pandas"
    - "visualization"

  # å›¾æ ‡
  icon: "ğŸ“Š"

  # åˆ›å»º/æ›´æ–°æ—¶é—´
  created_at: "2025-01-15T08:00:00Z"
  updated_at: "2025-02-20T10:30:00Z"

# è¿è¡Œæ—¶é…ç½®
runtime:
  # æ‰§è¡Œç¯å¢ƒç±»å‹
  environment: "python"

  # æ‰€éœ€æƒé™çº§åˆ«
  permission_level: "standard"

  # èµ„æºé™åˆ¶
  resources:
    memory_limit: "512MB"
    cpu_limit: "1.0"
    timeout: 300  # ç§’

  # ä¾èµ–é¡¹
  dependencies:
    - name: "pandas"
      version: ">=1.3.0"
    - name: "numpy"
      version: ">=1.20.0"
    - name: "matplotlib"
      version: ">=3.4.0"

  # è¾“å…¥å‚æ•°å®šä¹‰
  inputs:
    - name: "data_source"
      type: "string"
      required: true
      description: "æ•°æ®æºè·¯å¾„æˆ–URL"

    - name: "analysis_type"
      type: "enum"
      options: ["descriptive", "diagnostic", "predictive"]
      default: "descriptive"
      description: "åˆ†æç±»å‹"

  # è¾“å‡ºå®šä¹‰
  outputs:
    - name: "report"
      type: "markdown"
      description: "åˆ†ææŠ¥å‘Š"

    - name: "charts"
      type: "image_array"
      description: "å¯è§†åŒ–å›¾è¡¨"

# å®‰å…¨æ²™ç®±é…ç½®
sandbox:
  # å…è®¸çš„ç½‘ç»œè®¿é—®
  network_access: false

  # å…è®¸çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®
  filesystem_access: "readonly"

  # å…è®¸çš„ç³»ç»Ÿè°ƒç”¨
  allowed_syscalls:
    - "read"
    - "write"
    - "exit"

  # ç¯å¢ƒå˜é‡
  env_vars:
    - "PYTHONPATH"
    - "DATA_DIR"

# å†…å®¹éƒ¨åˆ† (Markdown æ ¼å¼)
content: |
  # Python æ•°æ®åˆ†ææ¨¡æ¿

  ## ä½¿ç”¨è¯´æ˜

  æœ¬ Skill æä¾›æ ‡å‡†åŒ–çš„æ•°æ®åˆ†ææµç¨‹ï¼ŒåŒ…æ‹¬ï¼š

  1. æ•°æ®åŠ è½½ä¸æ¸…æ´—
  2. æ¢ç´¢æ€§æ•°æ®åˆ†æ (EDA)
  3. å¯è§†åŒ–æŠ¥å‘Šç”Ÿæˆ

  ## ç¤ºä¾‹ä»£ç 

  ```python
  import pandas as pd
  import matplotlib.pyplot as plt

  # åŠ è½½æ•°æ®
  df = pd.read_csv(data_source)

  # åŸºç¡€ç»Ÿè®¡
  summary = df.describe()

  # ç”Ÿæˆå›¾è¡¨
  df.hist(figsize=(10, 8))
  plt.savefig('charts.png')
  ```

  ## æ³¨æ„äº‹é¡¹

  - ç¡®ä¿æ•°æ®æ–‡ä»¶æ ¼å¼æ­£ç¡®
  - å¤§æ–‡ä»¶å»ºè®®åˆ†æ‰¹å¤„ç†
```

### 2.2 è¿è¡Œæ—¶ç¯å¢ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Skill è¿è¡Œæ—¶ç¯å¢ƒ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Skill Runtime Container                      â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚  Python     â”‚  â”‚  Node.js    â”‚  â”‚  Shell      â”‚              â”‚   â”‚
â”‚  â”‚  â”‚  Runtime    â”‚  â”‚  Runtime    â”‚  â”‚  Runtime    â”‚              â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ - Python 3.9â”‚  â”‚ - Node 18   â”‚  â”‚ - Bash      â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ - pandas    â”‚  â”‚ - npm       â”‚  â”‚ - curl      â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ - numpy     â”‚  â”‚ - axios     â”‚  â”‚ - jq        â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚              Skill Execution Engine                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  1. è§£æ Skill YAML                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  2. éªŒè¯è¾“å…¥å‚æ•°                                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  3. å‡†å¤‡æ‰§è¡Œç¯å¢ƒ                                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  4. æ‰§è¡Œ Skill ä»£ç                                       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  5. æ•è·è¾“å‡ºç»“æœ                                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  6. æ¸…ç†èµ„æº                                             â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æƒé™æ²™ç®±

```typescript
// ============================================
// Skill æƒé™æ²™ç®±é…ç½®
// ============================================

interface SkillSandboxConfig {
  // ç½‘ç»œè®¿é—®æƒé™
  network: {
    enabled: boolean;
    allowlist?: string[];      // å…è®¸çš„åŸŸååˆ—è¡¨
    blocklist?: string[];      // ç¦æ­¢çš„åŸŸååˆ—è¡¨
    maxConnections?: number;   // æœ€å¤§è¿æ¥æ•°
  };

  // æ–‡ä»¶ç³»ç»Ÿæƒé™
  filesystem: {
    access: 'none' | 'readonly' | 'readwrite';
    allowPaths?: string[];     // å…è®¸çš„ç›®å½•
    maxFileSize?: number;      // æœ€å¤§æ–‡ä»¶å¤§å° (bytes)
    maxTotalSize?: number;     // æœ€å¤§æ€»å¤§å° (bytes)
  };

  // ç³»ç»Ÿèµ„æºé™åˆ¶
  resources: {
    memoryLimit: number;       // å†…å­˜é™åˆ¶ (MB)
    cpuLimit: number;          // CPU é™åˆ¶ (æ ¸å¿ƒæ•°)
    timeout: number;           // è¶…æ—¶æ—¶é—´ (ç§’)
    maxProcesses?: number;     // æœ€å¤§è¿›ç¨‹æ•°
  };

  // ç¯å¢ƒå˜é‡
  environment: {
    inherit: boolean;          // æ˜¯å¦ç»§æ‰¿çˆ¶ç¯å¢ƒ
    vars: Record<string, string>; // è‡ªå®šä¹‰ç¯å¢ƒå˜é‡
  };
}

// é¢„å®šä¹‰æƒé™çº§åˆ«
const PERMISSION_LEVELS: Record<string, SkillSandboxConfig> = {
  minimal: {
    network: { enabled: false },
    filesystem: { access: 'none' },
    resources: {
      memoryLimit: 128,
      cpuLimit: 0.5,
      timeout: 30
    },
    environment: { inherit: false, vars: {} }
  },

  standard: {
    network: { enabled: true, allowlist: ['api.sillymd.com'] },
    filesystem: { access: 'readonly', maxFileSize: 10 * 1024 * 1024 },
    resources: {
      memoryLimit: 512,
      cpuLimit: 1.0,
      timeout: 300
    },
    environment: { inherit: true, vars: {} }
  },

  elevated: {
    network: { enabled: true },
    filesystem: { access: 'readwrite', maxFileSize: 100 * 1024 * 1024 },
    resources: {
      memoryLimit: 2048,
      cpuLimit: 2.0,
      timeout: 600
    },
    environment: { inherit: true, vars: {} }
  }
};
```

---

## 3. åŒæ­¥æœºåˆ¶

### 3.1 åŒæ­¥è§¦å‘æ¡ä»¶

```typescript
// ============================================
// åŒæ­¥è§¦å‘æ¡ä»¶é…ç½®
// ============================================

interface SyncTriggerConfig {
  // å®æ—¶æ¨é€è§¦å‘æ¡ä»¶ (ç½‘ç«™ -> èŠå¤©å·¥å…·)
  pushTriggers: {
    // Skill å‘å¸ƒ
    onSkillPublish: boolean;
    // Skill æ›´æ–°
    onSkillUpdate: boolean;
    // Skill ä¸‹æ¶
    onSkillUnpublish: boolean;
    // ç‰ˆæœ¬å˜æ›´
    onVersionChange: boolean;
  };

  // å®šæ—¶æ‹‰å–è§¦å‘æ¡ä»¶ (èŠå¤©å·¥å…· -> ç½‘ç«™)
  pullTriggers: {
    // å¯åŠ¨æ—¶å…¨é‡åŒæ­¥
    onStartup: boolean;
    // å®šæ—¶å¢é‡åŒæ­¥ (åˆ†é’Ÿ)
    intervalMinutes: number;
    // ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°
    onManualRefresh: boolean;
    // ç½‘ç»œæ¢å¤ååŒæ­¥
    onNetworkResume: boolean;
  };

  // äº‹ä»¶ç›‘å¬è§¦å‘
  eventTriggers: {
    // WebSocket è¿æ¥çŠ¶æ€å˜åŒ–
    onConnectionChange: boolean;
    // ç”¨æˆ·è®¢é˜…å˜æ›´
    onSubscriptionChange: boolean;
  };
}

// é»˜è®¤é…ç½®
const DEFAULT_SYNC_CONFIG: SyncTriggerConfig = {
  pushTriggers: {
    onSkillPublish: true,
    onSkillUpdate: true,
    onSkillUnpublish: true,
    onVersionChange: true
  },
  pullTriggers: {
    onStartup: true,
    intervalMinutes: 5,
    onManualRefresh: true,
    onNetworkResume: true
  },
  eventTriggers: {
    onConnectionChange: true,
    onSubscriptionChange: true
  }
};
```

### 3.2 å¢é‡åŒæ­¥ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¢é‡åŒæ­¥æµç¨‹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  ç½‘ç«™ Skills  â”‚                    â”‚  èŠå¤©å·¥å…·     â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                                    â”‚                          â”‚
â”‚         â”‚  1. è·å–å˜æ›´åˆ—è¡¨                     â”‚                          â”‚
â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚                          â”‚
â”‚         â”‚                                    â”‚                          â”‚
â”‚         â”‚  {                                 â”‚                          â”‚
â”‚         â”‚    last_sync: "2025-02-20T10:00Z"  â”‚                          â”‚
â”‚         â”‚    client_version: "1.0.0"         â”‚                          â”‚
â”‚         â”‚  }                                 â”‚                          â”‚
â”‚         â”‚                                    â”‚                          â”‚
â”‚         â”‚  2. è¿”å›å˜æ›´æ•°æ®                     â”‚                          â”‚
â”‚         â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                          â”‚
â”‚         â”‚                                    â”‚                          â”‚
â”‚         â”‚  {                                 â”‚                          â”‚
â”‚         â”‚    changes: [                      â”‚                          â”‚
â”‚         â”‚      {                             â”‚                          â”‚
â”‚         â”‚        skill_id: "tech-xxx",       â”‚                          â”‚
â”‚         â”‚        action: "update",           â”‚                          â”‚
â”‚         â”‚        version: "1.2.0",           â”‚                          â”‚
â”‚         â”‚        diff_url: "/api/diff/xxx"   â”‚                          â”‚
â”‚         â”‚      }                             â”‚                          â”‚
â”‚         â”‚    ],                              â”‚                          â”‚
â”‚         â”‚    deleted: ["skill-old"],         â”‚                          â”‚
â”‚         â”‚    has_more: false                 â”‚                          â”‚
â”‚         â”‚  }                                 â”‚                          â”‚
â”‚         â”‚                                    â”‚                          â”‚
â”‚         â”‚  3. ä¸‹è½½å˜æ›´è¯¦æƒ…                     â”‚                          â”‚
â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚                          â”‚
â”‚         â”‚                                    â”‚                          â”‚
â”‚         â”‚  4. åº”ç”¨å˜æ›´åˆ°æœ¬åœ°                   â”‚                          â”‚
â”‚         â”‚                                    â”‚                          â”‚
â”‚         â”‚  5. ç¡®è®¤åŒæ­¥å®Œæˆ                     â”‚                          â”‚
â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚                          â”‚
â”‚         â”‚                                    â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// ============================================
// å¢é‡åŒæ­¥å®ç°
// ============================================

interface SyncChange {
  skillId: string;
  action: 'create' | 'update' | 'delete';
  version: string;
  timestamp: string;
  diffUrl?: string;           // å·®å¼‚å†…å®¹ä¸‹è½½åœ°å€
  fullUrl?: string;           // å®Œæ•´å†…å®¹ä¸‹è½½åœ°å€
  checksum: string;           // å†…å®¹æ ¡éªŒå’Œ
  size: number;               // å†…å®¹å¤§å°
}

interface SyncResponse {
  changes: SyncChange[];
  deleted: string[];
  hasMore: boolean;
  nextCursor?: string;
  serverTime: string;
}

class IncrementalSyncManager {
  private lastSyncTime: string | null = null;
  private localVersion: string = '0.0.0';

  // æ‰§è¡Œå¢é‡åŒæ­¥
  async sync(): Promise<SyncResult> {
    try {
      // 1. è·å–å˜æ›´åˆ—è¡¨
      const response = await this.fetchChanges();

      // 2. ä¸‹è½½å˜æ›´å†…å®¹
      const downloadedChanges = await this.downloadChanges(response.changes);

      // 3. åº”ç”¨å˜æ›´
      await this.applyChanges(downloadedChanges, response.deleted);

      // 4. æ›´æ–°åŒæ­¥çŠ¶æ€
      this.lastSyncTime = response.serverTime;

      // 5. è§¦å‘å®Œæˆå›è°ƒ
      this.onSyncComplete({
        success: true,
        changesCount: response.changes.length,
        deletedCount: response.deleted.length
      });

      return { success: true };
    } catch (error) {
      this.onSyncError(error);
      return { success: false, error };
    }
  }

  // è·å–å˜æ›´åˆ—è¡¨
  private async fetchChanges(): Promise<SyncResponse> {
    const response = await fetch('/api/skills/sync/changes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        last_sync: this.lastSyncTime,
        client_version: this.localVersion,
        categories: ['tech', 'product', 'design'],  // è®¢é˜…çš„åˆ†ç±»
        types: ['free', 'commercial']               // è®¢é˜…çš„ç±»å‹
      })
    });

    return response.json();
  }

  // ä¸‹è½½å˜æ›´å†…å®¹
  private async downloadChanges(changes: SyncChange[]): Promise<DownloadedChange[]> {
    const downloads = changes.map(async (change) => {
      const url = change.diffUrl || change.fullUrl;
      const response = await fetch(url);
      const content = await response.text();

      // éªŒè¯æ ¡éªŒå’Œ
      const checksum = await this.calculateChecksum(content);
      if (checksum !== change.checksum) {
        throw new Error(`Checksum mismatch for skill ${change.skillId}`);
      }

      return {
        ...change,
        content
      };
    });

    return Promise.all(downloads);
  }

  // åº”ç”¨å˜æ›´åˆ°æœ¬åœ°å­˜å‚¨
  private async applyChanges(
    changes: DownloadedChange[],
    deleted: string[]
  ): Promise<void> {
    const db = await this.openDatabase();

    await db.transaction(async (tx) => {
      // å¤„ç†åˆ é™¤
      for (const skillId of deleted) {
        await tx.executeSql('DELETE FROM skills WHERE skill_id = ?', [skillId]);
      }

      // å¤„ç†æ–°å¢/æ›´æ–°
      for (const change of changes) {
        if (change.action === 'create') {
          await tx.executeSql(
            `INSERT INTO skills (skill_id, version, content, updated_at)
             VALUES (?, ?, ?, ?)`,
            [change.skillId, change.version, change.content, change.timestamp]
          );
        } else if (change.action === 'update') {
          await tx.executeSql(
            `UPDATE skills
             SET version = ?, content = ?, updated_at = ?
             WHERE skill_id = ?`,
            [change.version, change.content, change.timestamp, change.skillId]
          );
        }
      }
    });
  }
}
```

### 3.3 ç‰ˆæœ¬ç®¡ç†

```typescript
// ============================================
// Skill ç‰ˆæœ¬ç®¡ç†
// ============================================

interface SkillVersion {
  version: string;            // ç‰ˆæœ¬å· (SemVer)
  parentVersion?: string;     // çˆ¶ç‰ˆæœ¬ (ç”¨äºåˆ†æ”¯)
  contentHash: string;        // å†…å®¹å“ˆå¸Œ
  createdAt: string;
  author: string;
  changelog: string;
  deprecated?: boolean;       // æ˜¯å¦å·²å¼ƒç”¨
}

class SkillVersionManager {
  // ç‰ˆæœ¬æ¯”è¾ƒ
  compareVersions(v1: string, v2: string): number {
    const parse = (v: string) => v.split('.').map(Number);
    const parts1 = parse(v1);
    const parts2 = parse(v2);

    for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {
      const p1 = parts1[i] || 0;
      const p2 = parts2[i] || 0;
      if (p1 > p2) return 1;
      if (p1 < p2) return -1;
    }
    return 0;
  }

  // æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§
  isCompatible(required: string, actual: string): boolean {
    // ç®€å•å®ç°ï¼šä¸»ç‰ˆæœ¬å·ç›¸åŒå³å…¼å®¹
    const reqMajor = required.split('.')[0];
    const actMajor = actual.split('.')[0];
    return reqMajor === actMajor;
  }

  // è§£æç‰ˆæœ¬çº¦æŸ
  parseVersionConstraint(constraint: string): VersionConstraint {
    // æ”¯æŒ: ^1.0.0, ~1.0.0, >=1.0.0, 1.0.0 - 2.0.0 ç­‰
    if (constraint.startsWith('^')) {
      return { type: 'caret', version: constraint.slice(1) };
    }
    if (constraint.startsWith('~')) {
      return { type: 'tilde', version: constraint.slice(1) };
    }
    if (constraint.startsWith('>=')) {
      return { type: 'gte', version: constraint.slice(2) };
    }
    return { type: 'exact', version: constraint };
  }

  // è·å–æœ€æ–°å…¼å®¹ç‰ˆæœ¬
  findLatestCompatible(
    versions: SkillVersion[],
    constraint: string
  ): SkillVersion | null {
    const vc = this.parseVersionConstraint(constraint);

    const compatible = versions.filter(v => {
      switch (vc.type) {
        case 'caret':
          return this.isCompatible(vc.version, v.version);
        case 'tilde':
          return v.version.startsWith(vc.version.split('.').slice(0, 2).join('.'));
        case 'gte':
          return this.compareVersions(v.version, vc.version) >= 0;
        case 'exact':
          return v.version === vc.version;
        default:
          return false;
      }
    });

    // æŒ‰ç‰ˆæœ¬å·æ’åºï¼Œè¿”å›æœ€æ–°
    compatible.sort((a, b) => this.compareVersions(b.version, a.version));
    return compatible[0] || null;
  }
}
```

---

## 4. Skills é¢‘é“

### 4.1 é¢‘é“ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Skills é¢‘é“ç»“æ„                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Skills Channel                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  é¡¶éƒ¨å¯¼èˆªæ                                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  [ å…¨éƒ¨ ] [ æŠ€æœ¯ ] [ äº§å“ ] [ è®¾è®¡ ] [ å¸‚åœº ] [ è¿è¥ ]   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  æœç´¢ä¸ç­›é€‰                                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  [ğŸ” æœç´¢ Skills...] [ ç±»å‹ â–¼ ] [ æ’åº â–¼ ]              â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  åˆ†ç±»å±•ç¤ºåŒºåŸŸ                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ“Š çƒ­é—¨æ¨è   â”‚  â”‚ ğŸ†• æœ€æ–°å‘å¸ƒ   â”‚  â”‚ â­ æˆ‘çš„æ”¶è—   â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Skill Card 1 â”‚  â”‚ Skill Card 4 â”‚  â”‚ Skill Card 7 â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Skill Card 2 â”‚  â”‚ Skill Card 5 â”‚  â”‚ Skill Card 8 â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Skill Card 3 â”‚  â”‚ Skill Card 6 â”‚  â”‚ Skill Card 9 â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ¢ å›¢é˜Ÿ Skillsâ”‚  â”‚ ğŸ å…è´¹ä¸“åŒº   â”‚                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚              â”‚  â”‚              â”‚                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Skill Card...â”‚  â”‚ Skill Card...â”‚                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  åº•éƒ¨æ“ä½œæ                                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  [ åˆ·æ–° ] [ åŒæ­¥çŠ¶æ€: âœ… ] [ è®¾ç½® ]                      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åˆ†ç±»å±•ç¤º

```typescript
// ============================================
// Skills åˆ†ç±»å±•ç¤ºé…ç½®
// ============================================

interface SkillCategoryConfig {
  id: string;
  name: string;
  icon: string;
  color: string;
  description: string;
  subcategories?: SkillCategoryConfig[];
}

const SKILL_CATEGORIES: SkillCategoryConfig[] = [
  {
    id: 'tech',
    name: 'æŠ€æœ¯',
    icon: 'ğŸ› ï¸',
    color: '#3B82F6',
    description: 'å¼€å‘å·¥å…·ã€æ¶æ„è®¾è®¡ã€è‡ªåŠ¨åŒ–ã€æ•°æ®å¤„ç†',
    subcategories: [
      { id: 'tech-dev', name: 'å¼€å‘å·¥å…·', icon: 'ğŸ’»', color: '#60A5FA', description: 'ä»£ç ç”Ÿæˆå™¨ã€è°ƒè¯•å·¥å…·' },
      { id: 'tech-arch', name: 'æ¶æ„è®¾è®¡', icon: 'ğŸ—ï¸', color: '#60A5FA', description: 'ç³»ç»Ÿæ¶æ„ã€å¾®æœåŠ¡' },
      { id: 'tech-auto', name: 'è‡ªåŠ¨åŒ–', icon: 'ğŸ¤–', color: '#60A5FA', description: 'CI/CDã€è„šæœ¬' },
      { id: 'tech-data', name: 'æ•°æ®å¤„ç†', icon: 'ğŸ“Š', color: '#60A5FA', description: 'ETLã€æ•°æ®æ¸…æ´—' }
    ]
  },
  {
    id: 'product',
    name: 'äº§å“',
    icon: 'ğŸ“¦',
    color: '#F59E0B',
    description: 'éœ€æ±‚ç®¡ç†ã€ç”¨æˆ·ç ”ç©¶ã€äº§å“è§„åˆ’ã€æ•°æ®åˆ†æ'
  },
  {
    id: 'design',
    name: 'è®¾è®¡',
    icon: 'ğŸ¨',
    color: '#EC4899',
    description: 'UI è®¾è®¡ã€UX è®¾è®¡ã€å“ç‰Œè®¾è®¡'
  },
  {
    id: 'marketing',
    name: 'å¸‚åœº',
    icon: 'ğŸ“ˆ',
    color: '#10B981',
    description: 'å†…å®¹è¥é”€ã€ç¤¾äº¤åª’ä½“ã€å¹¿å‘ŠæŠ•æ”¾'
  },
  {
    id: 'ops',
    name: 'è¿è¥',
    icon: 'âš™ï¸',
    color: '#8B5CF6',
    description: 'ç”¨æˆ·è¿è¥ã€æ´»åŠ¨è¿è¥ã€å†…å®¹è¿è¥'
  }
];

// å±•ç¤ºåŒºå—é…ç½®
interface DisplaySection {
  id: string;
  title: string;
  type: 'carousel' | 'grid' | 'list';
  filter: SkillFilter;
  sort: SkillSort;
  limit: number;
  refreshInterval?: number;  // è‡ªåŠ¨åˆ·æ–°é—´éš” (ç§’)
}

const DEFAULT_SECTIONS: DisplaySection[] = [
  {
    id: 'hot',
    title: 'çƒ­é—¨æ¨è',
    type: 'carousel',
    filter: { minRating: 4.0, minDownloads: 100 },
    sort: { field: 'download_count', order: 'desc' },
    limit: 10,
    refreshInterval: 3600
  },
  {
    id: 'latest',
    title: 'æœ€æ–°å‘å¸ƒ',
    type: 'grid',
    filter: { publishedWithin: '7d' },
    sort: { field: 'published_at', order: 'desc' },
    limit: 12,
    refreshInterval: 300
  },
  {
    id: 'favorites',
    title: 'æˆ‘çš„æ”¶è—',
    type: 'grid',
    filter: { favorited: true },
    sort: { field: 'favorited_at', order: 'desc' },
    limit: 12
  },
  {
    id: 'team',
    title: 'å›¢é˜Ÿ Skills',
    type: 'list',
    filter: { teamOnly: true },
    sort: { field: 'updated_at', order: 'desc' },
    limit: 20
  }
];
```

### 4.3 æœç´¢å‘ç°

```typescript
// ============================================
// Skills æœç´¢åŠŸèƒ½
// ============================================

interface SearchConfig {
  // æœç´¢å¼•æ“é…ç½®
  engine: 'local' | 'remote' | 'hybrid';

  // æœ¬åœ°æœç´¢é…ç½®
  local: {
    // ç´¢å¼•å­—æ®µæƒé‡
    fieldWeights: {
      name: 10;
      description: 5;
      tags: 8;
      content: 3;
      author: 2;
    };
    // æ¨¡ç³ŠåŒ¹é…
    fuzzy: boolean;
    // å‰ç¼€åŒ¹é…
    prefix: boolean;
  };

  // æœç´¢å»ºè®®
  suggestions: {
    enabled: boolean;
    maxSuggestions: number;
    minInputLength: number;
  };

  // æœç´¢å†å²
  history: {
    enabled: boolean;
    maxHistory: number;
    persist: boolean;
  };
}

interface SearchResult {
  skill: Skill;
  score: number;
  highlights: {
    field: string;
    snippet: string;
  }[];
  matchedFields: string[];
}

class SkillSearchEngine {
  private index: SearchIndex;

  // æ„å»ºæœç´¢ç´¢å¼•
  async buildIndex(skills: Skill[]): Promise<void> {
    const documents = skills.map(skill => ({
      id: skill.id,
      name: skill.name,
      description: skill.description,
      tags: skill.tags.join(' '),
      content: skill.content,
      author: skill.author.name,
      category: skill.category
    }));

    await this.index.addDocuments(documents);
  }

  // æ‰§è¡Œæœç´¢
  async search(query: string, options: SearchOptions): Promise<SearchResult[]> {
    // æœ¬åœ°æœç´¢
    const localResults = await this.localSearch(query, options);

    // å¦‚æœå¯ç”¨è¿œç¨‹æœç´¢ï¼Œåˆå¹¶ç»“æœ
    if (this.config.engine === 'hybrid' || this.config.engine === 'remote') {
      const remoteResults = await this.remoteSearch(query, options);
      return this.mergeResults(localResults, remoteResults);
    }

    return localResults;
  }

  // è·å–æœç´¢å»ºè®®
  async getSuggestions(input: string): Promise<string[]> {
    if (input.length < this.config.suggestions.minInputLength) {
      return [];
    }

    // ä»æœç´¢å†å²è·å–
    const history = await this.getSearchHistory();
    const historyMatches = history
      .filter(h => h.toLowerCase().includes(input.toLowerCase()))
      .slice(0, 3);

    // ä»çƒ­é—¨æœç´¢è·å–
    const popular = await this.getPopularSearches();
    const popularMatches = popular
      .filter(p => p.toLowerCase().includes(input.toLowerCase()))
      .slice(0, 3);

    // ä»æ ‡ç­¾è·å–
    const tagMatches = await this.getTagSuggestions(input);

    return [...new Set([...historyMatches, ...popularMatches, ...tagMatches])]
      .slice(0, this.config.suggestions.maxSuggestions);
  }

  // é«˜çº§ç­›é€‰
  async filterSkills(filters: SkillFilter): Promise<Skill[]> {
    let results = await this.getAllSkills();

    // åˆ†ç±»ç­›é€‰
    if (filters.categories?.length) {
      results = results.filter(s => filters.categories!.includes(s.category));
    }

    // ç±»å‹ç­›é€‰
    if (filters.types?.length) {
      results = results.filter(s => filters.types!.includes(s.type));
    }

    // æ ‡ç­¾ç­›é€‰
    if (filters.tags?.length) {
      results = results.filter(s =>
        filters.tags!.some(tag => s.tags.includes(tag))
      );
    }

    // è¯„åˆ†ç­›é€‰
    if (filters.minRating) {
      results = results.filter(s => s.rating >= filters.minRating!);
    }

    // ä»·æ ¼ç­›é€‰
    if (filters.priceRange) {
      results = results.filter(s =>
        s.price >= filters.priceRange!.min &&
        s.price <= filters.priceRange!.max
      );
    }

    // æ—¶é—´ç­›é€‰
    if (filters.publishedWithin) {
      const cutoff = this.parseTimeRange(filters.publishedWithin);
      results = results.filter(s => new Date(s.publishedAt) >= cutoff);
    }

    return results;
  }
}
```

---

## 5. æ‰§è¡Œç¯å¢ƒ

### 5.1 æ²™ç®±è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Skill æ²™ç®±æ¶æ„                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Sandbox Manager                               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚  Container 1 â”‚  â”‚  Container 2 â”‚  â”‚  Container N â”‚          â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Skill  â”‚  â”‚  â”‚  â”‚ Skill  â”‚  â”‚  â”‚  â”‚ Skill  â”‚  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Code   â”‚  â”‚  â”‚  â”‚ Code   â”‚  â”‚  â”‚  â”‚ Code   â”‚  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Resourceâ”‚  â”‚  â”‚  â”‚ Resourceâ”‚  â”‚  â”‚  â”‚ Resourceâ”‚  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Monitorâ”‚  â”‚  â”‚  â”‚ Monitorâ”‚  â”‚  â”‚  â”‚ Monitorâ”‚  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Networkâ”‚  â”‚  â”‚  â”‚ Networkâ”‚  â”‚  â”‚  â”‚ Networkâ”‚  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Proxy  â”‚  â”‚  â”‚  â”‚ Proxy  â”‚  â”‚  â”‚  â”‚ Proxy  â”‚  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚              Resource Pool                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - CPU: 4 cores                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - Memory: 8GB                                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - Disk: 100GB                                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - Network: 100Mbps                                      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// ============================================
// æ²™ç®±å®ç°
// ============================================

interface SandboxOptions {
  skillId: string;
  runtime: 'python' | 'nodejs' | 'shell';
  resources: ResourceLimits;
  permissions: PermissionConfig;
  timeout: number;
}

interface ExecutionResult {
  success: boolean;
  output: string;
  error?: string;
  exitCode: number;
  executionTime: number;
  memoryUsed: number;
  artifacts?: ExecutionArtifact[];
}

class SkillSandbox {
  private containerId: string | null = null;

  // åˆ›å»ºæ²™ç®±ç¯å¢ƒ
  async create(options: SandboxOptions): Promise<void> {
    // 1. åˆ›å»ºéš”ç¦»å®¹å™¨
    this.containerId = await this.createContainer({
      image: this.getRuntimeImage(options.runtime),
      resources: {
        memory: options.resources.memoryLimit,
        cpus: options.resources.cpuLimit
      },
      network: options.permissions.network.enabled ? 'bridge' : 'none',
      readOnlyRoot: true
    });

    // 2. è®¾ç½®æ–‡ä»¶ç³»ç»Ÿ
    await this.setupFilesystem(this.containerId, options.permissions.filesystem);

    // 3. é…ç½®ç½‘ç»œä»£ç†
    if (options.permissions.network.enabled) {
      await this.setupNetworkProxy(this.containerId, options.permissions.network);
    }

    // 4. æŒ‚è½½ Skill ä»£ç 
    await this.mountSkillCode(this.containerId, options.skillId);
  }

  // æ‰§è¡Œ Skill
  async execute(inputs: Record<string, any>): Promise<ExecutionResult> {
    if (!this.containerId) {
      throw new Error('Sandbox not initialized');
    }

    const startTime = Date.now();

    try {
      // å†™å…¥è¾“å…¥å‚æ•°
      await this.writeInputs(this.containerId, inputs);

      // æ‰§è¡Œä»£ç 
      const result = await this.runContainer(this.containerId, {
        timeout: this.options.timeout,
        captureOutput: true
      });

      // è¯»å–è¾“å‡º
      const output = await this.readOutput(this.containerId);
      const artifacts = await this.collectArtifacts(this.containerId);

      return {
        success: result.exitCode === 0,
        output,
        exitCode: result.exitCode,
        executionTime: Date.now() - startTime,
        memoryUsed: result.memoryUsed,
        artifacts
      };
    } catch (error) {
      return {
        success: false,
        output: '',
        error: error.message,
        exitCode: -1,
        executionTime: Date.now() - startTime,
        memoryUsed: 0
      };
    }
  }

  // é”€æ¯æ²™ç®±
  async destroy(): Promise<void> {
    if (this.containerId) {
      await this.removeContainer(this.containerId, { force: true });
      this.containerId = null;
    }
  }

  // èµ„æºç›‘æ§
  private async monitorResources(): Promise<void> {
    setInterval(async () => {
      if (!this.containerId) return;

      const stats = await this.getContainerStats(this.containerId);

      // æ£€æŸ¥èµ„æºé™åˆ¶
      if (stats.memory > this.options.resources.memoryLimit * 1024 * 1024) {
        await this.killContainer(this.containerId, 'SIGKILL');
        throw new Error('Memory limit exceeded');
      }

      if (stats.cpu > this.options.resources.cpuLimit * 100) {
        await this.throttleContainer(this.containerId);
      }
    }, 1000);
  }
}
```

### 5.2 èµ„æºé™åˆ¶

```typescript
// ============================================
// èµ„æºé™åˆ¶é…ç½®
// ============================================

interface ResourceLimits {
  // CPU é™åˆ¶
  cpuLimit: number;              // CPU æ ¸å¿ƒæ•° (å¦‚: 0.5, 1, 2)
  cpuQuota?: number;             // CPU é…é¢ (å¾®ç§’/å‘¨æœŸ)
  cpuPeriod?: number;            // CPU å‘¨æœŸ (å¾®ç§’)

  // å†…å­˜é™åˆ¶
  memoryLimit: number;           // å†…å­˜é™åˆ¶ (MB)
  memorySwap?: number;           // äº¤æ¢ç©ºé—´é™åˆ¶ (MB, -1 è¡¨ç¤ºæ— é™åˆ¶)
  memoryReservation?: number;    // å†…å­˜é¢„ç•™ (MB)

  // ç£ç›˜é™åˆ¶
  diskLimit?: number;            // ç£ç›˜ç©ºé—´é™åˆ¶ (MB)
  diskIO?: {
    readIOPS?: number;
    writeIOPS?: number;
    readBPS?: number;
    writeBPS?: number;
  };

  // ç½‘ç»œé™åˆ¶
  networkLimit?: {
    bandwidth?: number;          // å¸¦å®½é™åˆ¶ (Mbps)
    maxConnections?: number;     // æœ€å¤§è¿æ¥æ•°
    maxRequestsPerSecond?: number;
  };

  // è¿›ç¨‹é™åˆ¶
  maxProcesses?: number;         // æœ€å¤§è¿›ç¨‹æ•°
  maxFiles?: number;             // æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°

  // æ—¶é—´é™åˆ¶
  timeout: number;               // æ‰§è¡Œè¶…æ—¶ (ç§’)
  maxIdleTime?: number;          // æœ€å¤§ç©ºé—²æ—¶é—´ (ç§’)
}

// èµ„æºé™åˆ¶çº§åˆ«
const RESOURCE_LIMITS = {
  minimal: {
    cpuLimit: 0.5,
    memoryLimit: 128,
    timeout: 30,
    maxProcesses: 10,
    maxFiles: 100
  },

  standard: {
    cpuLimit: 1.0,
    memoryLimit: 512,
    timeout: 300,
    maxProcesses: 50,
    maxFiles: 1000
  },

  elevated: {
    cpuLimit: 2.0,
    memoryLimit: 2048,
    timeout: 600,
    maxProcesses: 100,
    maxFiles: 10000
  }
};

class ResourceLimiter {
  // åº”ç”¨èµ„æºé™åˆ¶
  async applyLimits(containerId: string, limits: ResourceLimits): Promise<void> {
    // CPU é™åˆ¶
    await this.setCPULimit(containerId, limits.cpuLimit);

    // å†…å­˜é™åˆ¶
    await this.setMemoryLimit(containerId, limits.memoryLimit);

    // è¿›ç¨‹é™åˆ¶
    if (limits.maxProcesses) {
      await this.setProcessLimit(containerId, limits.maxProcesses);
    }

    // æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
    if (limits.maxFiles) {
      await this.setFileLimit(containerId, limits.maxFiles);
    }
  }

  // ç›‘æ§èµ„æºä½¿ç”¨
  async monitorUsage(containerId: string): Promise<ResourceUsage> {
    const stats = await this.getContainerStats(containerId);

    return {
      cpu: {
        usage: stats.cpu.usage_percent,
        throttled: stats.cpu.throttled_time
      },
      memory: {
        used: stats.memory.usage,
        limit: stats.memory.limit,
        percent: (stats.memory.usage / stats.memory.limit) * 100
      },
      disk: {
        read: stats.disk.read_bytes,
        write: stats.disk.write_bytes
      },
      network: {
        rx: stats.network.rx_bytes,
        tx: stats.network.tx_bytes
      },
      processes: stats.pids.current
    };
  }
}
```

### 5.3 è¶…æ—¶æ§åˆ¶

```typescript
// ============================================
// è¶…æ—¶æ§åˆ¶æœºåˆ¶
// ============================================

interface TimeoutConfig {
  // æ‰§è¡Œè¶…æ—¶
  execution: number;

  // åˆå§‹åŒ–è¶…æ—¶
  initialization: number;

  // æ¸…ç†è¶…æ—¶
  cleanup: number;

  // ç©ºé—²è¶…æ—¶
  idle: number;

  // ç½‘ç»œè¯·æ±‚è¶…æ—¶
  networkRequest: number;

  // æ€»è¿è¡Œæ—¶é—´é™åˆ¶
  totalRuntime: number;
}

class TimeoutController {
  private timeouts: Map<string, NodeJS.Timeout> = new Map();
  private startTimes: Map<string, number> = new Map();

  // è®¾ç½®æ‰§è¡Œè¶…æ—¶
  setExecutionTimeout(
    executionId: string,
    timeoutMs: number,
    onTimeout: () => void
  ): void {
    this.startTimes.set(executionId, Date.now());

    const timeout = setTimeout(() => {
      this.handleTimeout(executionId, onTimeout);
    }, timeoutMs);

    this.timeouts.set(executionId, timeout);
  }

  // æ¸…é™¤è¶…æ—¶
  clearTimeout(executionId: string): void {
    const timeout = this.timeouts.get(executionId);
    if (timeout) {
      clearTimeout(timeout);
      this.timeouts.delete(executionId);
      this.startTimes.delete(executionId);
    }
  }

  // è·å–å‰©ä½™æ—¶é—´
  getRemainingTime(executionId: string): number {
    const startTime = this.startTimes.get(executionId);
    if (!startTime) return 0;

    const elapsed = Date.now() - startTime;
    const timeout = this.timeouts.get(executionId);
    // è¿™é‡Œéœ€è¦å­˜å‚¨åŸå§‹è¶…æ—¶æ—¶é—´
    return Math.max(0, this.getOriginalTimeout(executionId) - elapsed);
  }

  // å¤„ç†è¶…æ—¶
  private async handleTimeout(
    executionId: string,
    onTimeout: () => void
  ): Promise<void> {
    console.warn(`Execution ${executionId} timed out`);

    // æ‰§è¡Œè¶…æ—¶å›è°ƒ
    onTimeout();

    // å¼ºåˆ¶ç»ˆæ­¢æ‰§è¡Œ
    await this.forceTerminate(executionId);

    // æ¸…ç†èµ„æº
    this.clearTimeout(executionId);
  }

  // å¼ºåˆ¶ç»ˆæ­¢
  private async forceTerminate(executionId: string): Promise<void> {
    // å‘é€ç»ˆæ­¢ä¿¡å·
    await this.sendKillSignal(executionId, 'SIGTERM');

    // ç­‰å¾…ä¼˜é›…ç»ˆæ­¢
    await this.sleep(5000);

    // å¼ºåˆ¶æ€æ­»
    await this.sendKillSignal(executionId, 'SIGKILL');
  }

  private sleep(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}
```

---

## 6. å®‰å…¨è€ƒè™‘

### 6.1 ä»£ç å®¡è®¡

```typescript
// ============================================
// Skill ä»£ç å®¡è®¡
// ============================================

interface SecurityAuditResult {
  passed: boolean;
  score: number;              // å®‰å…¨è¯„åˆ† (0-100)
  issues: SecurityIssue[];
  warnings: SecurityWarning[];
}

interface SecurityIssue {
  level: 'critical' | 'high' | 'medium' | 'low';
  category: string;
  message: string;
  line?: number;
  code?: string;
  remediation: string;
}

class SkillSecurityAuditor {
  private static DANGEROUS_PATTERNS = [
    // å±é™©å‡½æ•°
    { pattern: /eval\s*\(/, level: 'critical', category: 'code_injection' },
    { pattern: /exec\s*\(/, level: 'critical', category: 'command_injection' },
    { pattern: /system\s*\(/, level: 'critical', category: 'command_injection' },

    // æ–‡ä»¶æ“ä½œ
    { pattern: /open\s*\([^)]*['"]w/, level: 'high', category: 'file_write' },
    { pattern: /rm\s+-rf/, level: 'critical', category: 'destructive_operation' },

    // ç½‘ç»œæ“ä½œ
    { pattern: /requests\.get\s*\([^)]*http:\/\//, level: 'medium', category: 'insecure_http' },
    { pattern: /urllib\.request\.urlopen/, level: 'medium', category: 'network_access' },

    // æ•æ„Ÿä¿¡æ¯
    { pattern: /password\s*=\s*['"][^'"]+['"]/i, level: 'high', category: 'hardcoded_secret' },
    { pattern: /api_key\s*=\s*['"][^'"]+['"]/i, level: 'high', category: 'hardcoded_secret' },
    { pattern: /token\s*=\s*['"][^'"]+['"]/i, level: 'high', category: 'hardcoded_secret' },

    // ååºåˆ—åŒ–
    { pattern: /pickle\.loads?\s*\(/, level: 'critical', category: 'unsafe_deserialization' },
    { pattern: /yaml\.load\s*\([^)]*Loader\s*=\s*yaml\.Loader/, level: 'high', category: 'unsafe_yaml' }
  ];

  // æ‰§è¡Œå®‰å…¨å®¡è®¡
  async audit(skillCode: string, skillConfig: SkillConfig): Promise<SecurityAuditResult> {
    const issues: SecurityIssue[] = [];
    const warnings: SecurityWarning[] = [];

    // 1. é™æ€ä»£ç åˆ†æ
    const staticIssues = await this.staticAnalysis(skillCode);
    issues.push(...staticIssues);

    // 2. ä¾èµ–å®‰å…¨æ£€æŸ¥
    if (skillConfig.runtime?.dependencies) {
      const depIssues = await this.checkDependencies(skillConfig.runtime.dependencies);
      issues.push(...depIssues);
    }

    // 3. æƒé™é…ç½®å®¡æŸ¥
    const permissionIssues = this.auditPermissions(skillConfig.sandbox);
    issues.push(...permissionIssues);

    // 4. ç½‘ç»œè®¿é—®å®¡æŸ¥
    if (skillConfig.sandbox?.network_access) {
      warnings.push({
        category: 'network_access',
        message: 'Skill è¯·æ±‚ç½‘ç»œè®¿é—®æƒé™ï¼Œè¯·ç¡®ä¿ä»…è®¿é—®å¿…è¦çš„åŸŸå'
      });
    }

    // è®¡ç®—å®‰å…¨è¯„åˆ†
    const score = this.calculateSecurityScore(issues);

    return {
      passed: !issues.some(i => i.level === 'critical' || i.level === 'high'),
      score,
      issues,
      warnings
    };
  }

  // é™æ€ä»£ç åˆ†æ
  private async staticAnalysis(code: string): Promise<SecurityIssue[]> {
    const issues: SecurityIssue[] = [];
    const lines = code.split('\n');

    for (let i = 0; i < lines.length; i++) {
      const line = lines[i];

      for (const pattern of SkillSecurityAuditor.DANGEROUS_PATTERNS) {
        if (pattern.pattern.test(line)) {
          issues.push({
            level: pattern.level as any,
            category: pattern.category,
            message: `å‘ç°æ½œåœ¨å®‰å…¨é£é™©: ${pattern.category}`,
            line: i + 1,
            code: line.trim(),
            remediation: this.getRemediation(pattern.category)
          });
        }
      }
    }

    return issues;
  }

  // ä¾èµ–å®‰å…¨æ£€æŸ¥
  private async checkDependencies(dependencies: Dependency[]): Promise<SecurityIssue[]> {
    const issues: SecurityIssue[] = [];

    for (const dep of dependencies) {
      // æ£€æŸ¥å·²çŸ¥æ¼æ´
      const vulnerabilities = await this.checkVulnerabilityDatabase(dep.name, dep.version);

      for (const vuln of vulnerabilities) {
        issues.push({
          level: vuln.severity,
          category: 'vulnerable_dependency',
          message: `ä¾èµ– ${dep.name}@${dep.version} å­˜åœ¨å·²çŸ¥æ¼æ´: ${vuln.cve}`,
          remediation: `å‡çº§åˆ° ${dep.name}@${vuln.fixedVersion} æˆ–æ›´é«˜ç‰ˆæœ¬`
        });
      }
    }

    return issues;
  }

  // è®¡ç®—å®‰å…¨è¯„åˆ†
  private calculateSecurityScore(issues: SecurityIssue[]): number {
    let score = 100;

    for (const issue of issues) {
      switch (issue.level) {
        case 'critical': score -= 30; break;
        case 'high': score -= 15; break;
        case 'medium': score -= 5; break;
        case 'low': score -= 2; break;
      }
    }

    return Math.max(0, score);
  }
}
```

### 6.2 æƒé™ç”³è¯·

```typescript
// ============================================
// Skill æƒé™ç”³è¯·ä¸æˆæƒ
// ============================================

interface PermissionRequest {
  skillId: string;
  skillName: string;
  requestedPermissions: Permission[];
  reason: string;
}

interface Permission {
  type: 'network' | 'filesystem' | 'camera' | 'microphone' | 'location' | 'clipboard';
  action: 'read' | 'write' | 'execute';
  resource?: string;          // å…·ä½“èµ„æº (å¦‚: ç‰¹å®šåŸŸåã€æ–‡ä»¶è·¯å¾„)
}

class PermissionManager {
  // è¯·æ±‚æƒé™
  async requestPermission(
    request: PermissionRequest
  ): Promise<PermissionGrantResult> {
    // 1. æ£€æŸ¥æ˜¯å¦å·²æœ‰æƒé™
    const existing = await this.getExistingPermissions(request.skillId);
    const newPermissions = this.filterNewPermissions(
      request.requestedPermissions,
      existing
    );

    if (newPermissions.length === 0) {
      return { granted: true, permissions: existing };
    }

    // 2. è¯„ä¼°æƒé™é£é™©
    const riskAssessment = this.assessPermissionRisk(newPermissions);

    // 3. æ ¹æ®é£é™©çº§åˆ«å†³å®šæˆæƒæ–¹å¼
    if (riskAssessment.level === 'low') {
      // ä½é£é™©ï¼šè‡ªåŠ¨æˆæƒ
      return this.autoGrant(request.skillId, newPermissions);
    } else if (riskAssessment.level === 'medium') {
      // ä¸­é£é™©ï¼šæç¤ºç”¨æˆ·ç¡®è®¤
      return this.promptUser(request, riskAssessment);
    } else {
      // é«˜é£é™©ï¼šéœ€è¦è¯¦ç»†å®¡æ ¸
      return this.requireDetailedReview(request, riskAssessment);
    }
  }

  // è¯„ä¼°æƒé™é£é™©
  private assessPermissionRisk(permissions: Permission[]): RiskAssessment {
    let score = 0;
    const concerns: string[] = [];

    for (const perm of permissions) {
      switch (perm.type) {
        case 'network':
          if (perm.action === 'write') {
            score += 30;
            concerns.push('ç½‘ç»œå†™å…¥æƒé™å¯èƒ½ç”¨äºæ•°æ®å¤–æ³„');
          } else {
            score += 10;
          }
          break;

        case 'filesystem':
          if (perm.action === 'write') {
            score += 40;
            concerns.push('æ–‡ä»¶å†™å…¥æƒé™å¯èƒ½ç ´åç³»ç»Ÿæ–‡ä»¶');
          } else if (perm.action === 'execute') {
            score += 50;
            concerns.push('æ–‡ä»¶æ‰§è¡Œæƒé™å­˜åœ¨ä»£ç æ³¨å…¥é£é™©');
          } else {
            score += 20;
          }
          break;

        case 'camera':
        case 'microphone':
          score += 35;
          concerns.push(`${perm.type} æƒé™æ¶‰åŠéšç§æ•æ„Ÿæ“ä½œ`);
          break;

        case 'location':
          score += 25;
          concerns.push('ä½ç½®ä¿¡æ¯å±äºæ•æ„Ÿæ•°æ®');
          break;
      }
    }

    let level: 'low' | 'medium' | 'high';
    if (score < 30) level = 'low';
    else if (score < 70) level = 'medium';
    else level = 'high';

    return { level, score, concerns };
  }

  // ç”¨æˆ·ç¡®è®¤å¯¹è¯æ¡†
  private async promptUser(
    request: PermissionRequest,
    risk: RiskAssessment
  ): Promise<PermissionGrantResult> {
    const confirmed = await this.showPermissionDialog({
      title: `${request.skillName} è¯·æ±‚æƒé™`,
      message: `è¯¥ Skill éœ€è¦ä»¥ä¸‹æƒé™:\n${this.formatPermissions(request.requestedPermissions)}`,
      riskLevel: risk.level,
      concerns: risk.concerns,
      rememberChoice: true
    });

    if (confirmed) {
      // ä¿å­˜ç”¨æˆ·é€‰æ‹©
      await this.savePermissionChoice(request.skillId, request.requestedPermissions);
      return { granted: true, permissions: request.requestedPermissions };
    }

    return { granted: false, reason: 'user_denied' };
  }
}
```

### 6.3 ç”¨æˆ·ç¡®è®¤

```typescript
// ============================================
// ç”¨æˆ·ç¡®è®¤æœºåˆ¶
// ============================================

interface UserConfirmation {
  // æ‰§è¡Œå‰ç¡®è®¤
  preExecution?: {
    enabled: boolean;
    showCode: boolean;          // æ˜¯å¦å±•ç¤ºä»£ç é¢„è§ˆ
    showInputs: boolean;        // æ˜¯å¦å±•ç¤ºè¾“å…¥å‚æ•°
    showPermissions: boolean;   // æ˜¯å¦å±•ç¤ºæ‰€éœ€æƒé™
  };

  // æ•æ„Ÿæ“ä½œç¡®è®¤
  sensitiveOperations: {
    networkWrite: boolean;
    filesystemWrite: boolean;
    credentialAccess: boolean;
    externalCommand: boolean;
  };

  // æ‰§è¡Œåé€šçŸ¥
  postExecution: {
    enabled: boolean;
    showOutput: boolean;
    showMetrics: boolean;       // æ˜¾ç¤ºèµ„æºä½¿ç”¨
    notifyOnComplete: boolean;
  };
}

class UserConfirmationManager {
  // æ‰§è¡Œå‰ç¡®è®¤
  async confirmBeforeExecution(
    skill: Skill,
    inputs: Record<string, any>,
    config: UserConfirmation
  ): Promise<boolean> {
    if (!config.preExecution?.enabled) {
      return true;
    }

    const dialogContent: DialogContent = {
      title: `ç¡®è®¤æ‰§è¡Œ "${skill.name}"?`,
      sections: []
    };

    // ä»£ç é¢„è§ˆ
    if (config.preExecution.showCode) {
      dialogContent.sections.push({
        title: 'ä»£ç é¢„è§ˆ',
        content: this.truncateCode(skill.content, 500),
        collapsible: true
      });
    }

    // è¾“å…¥å‚æ•°
    if (config.preExecution.showInputs && Object.keys(inputs).length > 0) {
      dialogContent.sections.push({
        title: 'è¾“å…¥å‚æ•°',
        content: this.formatInputs(inputs),
        type: 'table'
      });
    }

    // æ‰€éœ€æƒé™
    if (config.preExecution.showPermissions) {
      dialogContent.sections.push({
        title: 'æ‰€éœ€æƒé™',
        content: this.formatPermissions(skill.sandbox),
        type: 'list',
        highlight: 'warning'
      });
    }

    // é£é™©æç¤º
    const riskLevel = this.assessRiskLevel(skill);
    if (riskLevel !== 'low') {
      dialogContent.warning = {
        level: riskLevel,
        message: this.getRiskWarning(riskLevel, skill)
      };
    }

    return this.showConfirmationDialog(dialogContent);
  }

  // æ•æ„Ÿæ“ä½œå®æ—¶ç¡®è®¤
  async confirmSensitiveOperation(
    operation: string,
    details: string
  ): Promise<boolean> {
    return this.showConfirmationDialog({
      title: 'æ•æ„Ÿæ“ä½œç¡®è®¤',
      message: `Skill æ­£åœ¨å°è¯•æ‰§è¡Œæ•æ„Ÿæ“ä½œ: ${operation}`,
      details,
      warning: {
        level: 'high',
        message: 'è¯·ç¡®è®¤æ‚¨ä¿¡ä»»æ­¤ Skill å¹¶ç†è§£è¯¥æ“ä½œçš„åæœ'
      },
      requirePassword: true,      // éœ€è¦è¾“å…¥å¯†ç 
      timeout: 30                 // 30ç§’è¶…æ—¶
    });
  }

  // æ‰§è¡Œç»“æœå±•ç¤º
  async showExecutionResult(
    result: ExecutionResult,
    config: UserConfirmation
  ): Promise<void> {
    if (!config.postExecution?.enabled) {
      return;
    }

    const content: ResultContent = {
      success: result.success,
      title: result.success ? 'æ‰§è¡ŒæˆåŠŸ' : 'æ‰§è¡Œå¤±è´¥'
    };

    if (config.postExecution.showOutput && result.output) {
      content.output = result.output;
    }

    if (config.postExecution.showMetrics) {
      content.metrics = {
        executionTime: `${result.executionTime}ms`,
        memoryUsed: `${(result.memoryUsed / 1024 / 1024).toFixed(2)}MB`,
        exitCode: result.exitCode
      };
    }

    if (!result.success && result.error) {
      content.error = result.error;
    }

    await this.showResultDialog(content);
  }
}
```

---

## 7. API æ¥å£è®¾è®¡

### 7.1 åŒæ­¥ API

```typescript
// ============================================
// Skills åŒæ­¥ API
// ============================================

// POST /api/v1/skills/sync/changes
// è·å–å˜æ›´åˆ—è¡¨
interface GetChangesRequest {
  last_sync: string | null;     // ä¸Šæ¬¡åŒæ­¥æ—¶é—´
  client_version: string;       // å®¢æˆ·ç«¯ç‰ˆæœ¬
  categories?: string[];        // ç­›é€‰åˆ†ç±»
  types?: ('free' | 'commercial')[];
  tags?: string[];
}

interface GetChangesResponse {
  changes: SyncChange[];
  deleted: string[];
  has_more: boolean;
  next_cursor?: string;
  server_time: string;
}

// GET /api/v1/skills/sync/content/:skill_id
// è·å– Skill å®Œæ•´å†…å®¹
interface GetSkillContentResponse {
  skill_id: string;
  version: string;
  content: string;              // YAML + Markdown
  checksum: string;
  size: number;
  updated_at: string;
}

// GET /api/v1/skills/sync/diff/:skill_id
// è·å– Skill å·®å¼‚å†…å®¹
interface GetSkillDiffResponse {
  skill_id: string;
  from_version: string;
  to_version: string;
  diff: string;                 // unified diff æ ¼å¼
  checksum: string;
}

// POST /api/v1/skills/sync/ack
// ç¡®è®¤åŒæ­¥å®Œæˆ
interface SyncAckRequest {
  sync_id: string;
  received_changes: string[];   // å·²æ¥æ”¶çš„å˜æ›´ ID
  client_time: string;
}

// WebSocket /ws/skills/sync
// å®æ—¶åŒæ­¥æ¨é€
interface SyncWebSocketMessage {
  type: 'change' | 'delete' | 'heartbeat';
  timestamp: string;
  data?: SyncChange;
  skill_id?: string;
}
```

### 7.2 æ‰§è¡Œ API

```typescript
// ============================================
// Skills æ‰§è¡Œ API
// ============================================

// POST /api/v1/skills/execute
// æ‰§è¡Œ Skill
interface ExecuteSkillRequest {
  skill_id: string;
  version?: string;             // é»˜è®¤ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
  inputs: Record<string, any>;
  timeout?: number;
  async?: boolean;              // æ˜¯å¦å¼‚æ­¥æ‰§è¡Œ
}

interface ExecuteSkillResponse {
  execution_id: string;
  status: 'pending' | 'running' | 'completed' | 'failed';
  result?: ExecutionResult;
  websocket_url?: string;       // å¼‚æ­¥æ‰§è¡Œç»“æœæ¨é€
}

// GET /api/v1/skills/execute/:execution_id
// æŸ¥è¯¢æ‰§è¡ŒçŠ¶æ€
interface GetExecutionStatusResponse {
  execution_id: string;
  skill_id: string;
  status: 'pending' | 'running' | 'completed' | 'failed' | 'cancelled';
  progress?: number;            // æ‰§è¡Œè¿›åº¦ (0-100)
  result?: ExecutionResult;
  started_at?: string;
  completed_at?: string;
}

// POST /api/v1/skills/execute/:execution_id/cancel
// å–æ¶ˆæ‰§è¡Œ
interface CancelExecutionResponse {
  success: boolean;
  message: string;
}

// POST /api/v1/skills/validate
// éªŒè¯ Skill é…ç½®
interface ValidateSkillRequest {
  content: string;              // Skill YAML å†…å®¹
}

interface ValidateSkillResponse {
  valid: boolean;
  errors: ValidationError[];
  warnings: ValidationWarning[];
}
```

### 7.3 é¢‘é“ API

```typescript
// ============================================
// Skills é¢‘é“ API
// ============================================

// GET /api/v1/skills/channel/sections
// è·å–é¢‘é“åŒºå—é…ç½®
interface GetChannelSectionsResponse {
  sections: DisplaySection[];
  updated_at: string;
}

// GET /api/v1/skills/channel/search
// æœç´¢ Skills
interface SearchSkillsRequest {
  q: string;
  category?: string;
  type?: 'free' | 'commercial';
  tags?: string[];
  sort?: 'relevance' | 'rating' | 'downloads' | 'newest';
  page?: number;
  page_size?: number;
}

interface SearchSkillsResponse {
  items: SkillSummary[];
  total: number;
  page: number;
  page_size: number;
  suggestions?: string[];
}

// GET /api/v1/skills/channel/categories
// è·å–åˆ†ç±»åˆ—è¡¨
interface GetCategoriesResponse {
  categories: SkillCategoryConfig[];
}

// GET /api/v1/skills/channel/favorites
// è·å–æ”¶è—åˆ—è¡¨
interface GetFavoritesResponse {
  items: SkillSummary[];
  total: number;
}

// POST /api/v1/skills/channel/favorites
// æ·»åŠ æ”¶è—
interface AddFavoriteRequest {
  skill_id: string;
}

// DELETE /api/v1/skills/channel/favorites/:skill_id
// å–æ¶ˆæ”¶è—
```

### 7.4 Skills å¸‚åœºä¸äº¤æ˜“ API

```typescript
// ============================================
// Skills äº¤æ˜“å¸‚åœº API - ä¸Šä¼ ã€å‡ºå”®ã€é‡‡è´­
// ============================================

// --------------------------------------------
// Skill ä¸Šä¼ ä¸å‘å¸ƒ
// --------------------------------------------

// POST /api/v1/skills/market/upload
// ä¸Šä¼ æ–°çš„ Skill
interface UploadSkillRequest {
  // Skill å†…å®¹ (YAML + Markdown)
  content: string;

  // å…ƒæ•°æ®
  metadata: {
    name: string;
    description: string;
    category: string;
    tags: string[];
    icon?: string;              // Base64 å›¾æ ‡
    screenshots?: string[];     // Base64 æˆªå›¾
  };

  // å®šä»·ä¿¡æ¯
  pricing: {
    type: 'free' | 'onetime' | 'subscription';
    price?: number;             // äººæ°‘å¸ï¼Œåˆ†
    subscription?: {
      period: 'month' | 'year';
      price: number;
    };
    trial_days?: number;        // è¯•ç”¨å¤©æ•°
  };

  // æƒé™é…ç½®
  permissions: {
    network: boolean;
    filesystem: 'none' | 'readonly' | 'readwrite';
    sandbox_level: 'minimal' | 'standard' | 'elevated';
  };

  // ç‰ˆæœ¬ä¿¡æ¯
  version: {
    major: number;
    minor: number;
    patch: number;
    changelog: string;
  };
}

interface UploadSkillResponse {
  skill_id: string;
  version_id: string;
  status: 'pending_review' | 'published' | 'rejected';
  review_eta?: string;          // é¢„è®¡å®¡æ ¸å®Œæˆæ—¶é—´
  upload_url?: string;          // å¤§æ–‡ä»¶ä¸Šä¼ åœ°å€ï¼ˆå¦‚éœ€è¦ï¼‰
}

// PUT /api/v1/skills/market/:skill_id/update
// æ›´æ–° Skill ç‰ˆæœ¬
interface UpdateSkillRequest {
  skill_id: string;
  content: string;
  version: {
    major: number;
    minor: number;
    patch: number;
    changelog: string;
  };
  auto_publish: boolean;        // æ˜¯å¦è‡ªåŠ¨å‘å¸ƒï¼ˆå…è´¹Skillå¯ç”¨ï¼‰
}

// DELETE /api/v1/skills/market/:skill_id
// ä¸‹æ¶ Skill
interface DelistSkillRequest {
  skill_id: string;
  reason: string;
  notify_subscribers: boolean;
  refund_policy: 'full' | 'prorated' | 'none';
}

// --------------------------------------------
// Skill è´­ä¹°ä¸æˆæƒ
// --------------------------------------------

// GET /api/v1/skills/market/:skill_id/purchase/info
// è·å–è´­ä¹°ä¿¡æ¯
interface GetPurchaseInfoResponse {
  skill_id: string;
  name: string;
  pricing: {
    type: 'free' | 'onetime' | 'subscription';
    price: number;
    original_price?: number;    // æŠ˜æ‰£å‰ä»·æ ¼
    currency: 'CNY';
    subscription?: {
      period: 'month' | 'year';
      price: number;
    };
  };
  promotion?: {
    type: 'discount' | 'bundle' | 'trial';
    discount_percent?: number;
    end_time?: string;
    bundle_skills?: string[];
  };
  already_owned: boolean;
  can_trial: boolean;
  trial_days_remaining?: number;
}

// POST /api/v1/skills/market/:skill_id/purchase
// è´­ä¹° Skill
interface PurchaseSkillRequest {
  skill_id: string;
  payment_method: 'alipay' | 'wechat_pay' | 'balance' | 'card';
  coupon_code?: string;
  auto_renew?: boolean;         // è®¢é˜…åˆ¶è‡ªåŠ¨ç»­è´¹
}

interface PurchaseSkillResponse {
  order_id: string;
  status: 'pending_payment' | 'completed' | 'failed';
  payment_url?: string;         // æ”¯ä»˜è·³è½¬URL
  payment_qr?: string;          // æ”¯ä»˜äºŒç»´ç  Base64
  expires_at?: string;          // æ”¯ä»˜è¿‡æœŸæ—¶é—´
  license_key?: string;         // æˆæƒç ï¼ˆæ”¯ä»˜å®Œæˆåï¼‰
}

// GET /api/v1/skills/market/orders/:order_id
// æŸ¥è¯¢è®¢å•çŠ¶æ€
interface GetOrderResponse {
  order_id: string;
  skill_id: string;
  skill_name: string;
  amount: number;
  currency: 'CNY';
  status: 'pending' | 'paid' | 'refunded' | 'cancelled';
  created_at: string;
  paid_at?: string;
  license?: {
    key: string;
    expires_at?: string;        // è®¢é˜…è¿‡æœŸæ—¶é—´
    status: 'active' | 'expired' | 'revoked';
  };
}

// POST /api/v1/skills/market/orders/:order_id/refund
// ç”³è¯·é€€æ¬¾
interface RefundRequest {
  order_id: string;
  reason: string;
  type: 'full' | 'partial';
  amount?: number;              // éƒ¨åˆ†é€€æ¬¾é‡‘é¢
}

// --------------------------------------------
// Skill æˆæƒç®¡ç†
// --------------------------------------------

// GET /api/v1/skills/licenses
// è·å–æˆ‘çš„æˆæƒåˆ—è¡¨
interface GetLicensesResponse {
  licenses: SkillLicense[];
  total: number;
}

interface SkillLicense {
  license_id: string;
  skill_id: string;
  skill_name: string;
  skill_icon?: string;
  status: 'active' | 'expired' | 'suspended';
  type: 'free' | 'purchased' | 'subscription' | 'trial';

  // æœ‰æ•ˆæœŸ
  valid_from: string;
  valid_until?: string;         // null è¡¨ç¤ºæ°¸ä¹…

  // ä½¿ç”¨é™åˆ¶
  usage_limits?: {
    max_executions?: number;    // æœ€å¤§æ‰§è¡Œæ¬¡æ•°
    max_users?: number;         // æœ€å¤§ç”¨æˆ·æ•°ï¼ˆå›¢é˜Ÿç‰ˆï¼‰
  };

  // è‡ªåŠ¨ç»­è´¹ï¼ˆè®¢é˜…åˆ¶ï¼‰
  auto_renew?: boolean;
  next_billing_date?: string;

  // æ›´æ–°è®¸å¯
  updates_included: boolean;
  update_until?: string;
}

// POST /api/v1/skills/licenses/:license_id/activate
// æ¿€æ´»æˆæƒï¼ˆåœ¨å…¶ä»–è®¾å¤‡ä¸Šä½¿ç”¨ï¼‰
interface ActivateLicenseRequest {
  license_key: string;
  device_id: string;
  device_name: string;
}

// DELETE /api/v1/skills/licenses/:license_id/deactivate
// åœç”¨æˆæƒï¼ˆé‡Šæ”¾è®¾å¤‡é…é¢ï¼‰

// GET /api/v1/skills/licenses/:license_id/usage
// æŸ¥è¯¢æˆæƒä½¿ç”¨ç»Ÿè®¡
interface GetLicenseUsageResponse {
  license_id: string;
  total_executions: number;
  executions_this_month: number;
  active_devices: number;
  devices: {
    device_id: string;
    device_name: string;
    activated_at: string;
    last_used: string;
  }[];
}

// --------------------------------------------
// å¼€å‘è€…ä¸­å¿ƒ - æ”¶å…¥ç®¡ç†
// --------------------------------------------

// GET /api/v1/skills/developer/sales
// è·å–é”€å”®ç»Ÿè®¡
interface GetSalesStatsResponse {
  total_revenue: number;        // æ€»æ”¶å…¥ï¼ˆåˆ†ï¼‰
  this_month_revenue: number;
  total_sales: number;
  this_month_sales: number;

  skills: {
    skill_id: string;
    skill_name: string;
    total_revenue: number;
    total_sales: number;
    rating: number;
  }[];

  chart_data: {
    date: string;
    revenue: number;
    sales: number;
  }[];
}

// GET /api/v1/skills/developer/transactions
// è·å–äº¤æ˜“æ˜ç»†
interface GetTransactionsRequest {
  start_date?: string;
  end_date?: string;
  skill_id?: string;
  type?: 'sale' | 'refund' | 'withdrawal';
  page?: number;
  page_size?: number;
}

interface GetTransactionsResponse {
  transactions: Transaction[];
  total: number;
}

interface Transaction {
  id: string;
  type: 'sale' | 'refund' | 'withdrawal';
  skill_id?: string;
  skill_name?: string;
  amount: number;               // æ­£æ•°æ”¶å…¥ï¼Œè´Ÿæ•°é€€æ¬¾
  platform_fee: number;         // å¹³å°æŠ½æˆ
  net_amount: number;           // å‡€æ”¶å…¥
  status: 'pending' | 'completed' | 'failed';
  created_at: string;
  description?: string;
}

// POST /api/v1/skills/developer/withdraw
// æç°ç”³è¯·
interface WithdrawRequest {
  amount: number;               // æç°é‡‘é¢ï¼ˆåˆ†ï¼‰
  method: 'alipay' | 'bank_transfer';
  account_info: {
    account_name: string;
    account_number: string;
    bank_name?: string;
  };
}

// --------------------------------------------
// è´­ç‰©è½¦ä¸æ„¿æœ›å•
// --------------------------------------------

// GET /api/v1/skills/market/cart
// è·å–è´­ç‰©è½¦

// POST /api/v1/skills/market/cart
// æ·»åŠ åˆ°è´­ç‰©è½¦
interface AddToCartRequest {
  skill_id: string;
  pricing_type?: 'onetime' | 'subscription';  // é»˜è®¤ä¸º onetime
}

// DELETE /api/v1/skills/market/cart/:item_id
// ä»è´­ç‰©è½¦ç§»é™¤

// POST /api/v1/skills/market/cart/checkout
// è´­ç‰©è½¦ç»“ç®—
interface CheckoutCartRequest {
  payment_method: 'alipay' | 'wechat_pay' | 'balance';
  coupon_code?: string;
}

// GET /api/v1/skills/market/wishlist
// è·å–æ„¿æœ›å•

// POST /api/v1/skills/market/wishlist/:skill_id
// æ·»åŠ åˆ°æ„¿æœ›å•
```

### 7.5 äº¤æ˜“æµç¨‹è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Skills äº¤æ˜“æµç¨‹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€å‘å¸ƒæµç¨‹ã€‘
å¼€å‘è€…åˆ›å»º Skill â†’ ä¸Šä¼ å†…å®¹ â†’ è®¾ç½®ä»·æ ¼ â†’ æäº¤å®¡æ ¸ â†’ å¹³å°å®¡æ ¸ â†’ å‘å¸ƒä¸Šçº¿
     â”‚              â”‚           â”‚           â”‚           â”‚
     â–¼              â–¼           â–¼           â–¼           â–¼
  æœ¬åœ°å¼€å‘      å†…å®¹æ£€æŸ¥     å®šä»·ç­–ç•¥    å®‰å…¨å®¡è®¡    åˆ†ç±»ä¸Šæ¶
  åŠŸèƒ½æµ‹è¯•      æ ¼å¼éªŒè¯     ç«å“åˆ†æ    ä»£ç å®¡æŸ¥    æœç´¢ç´¢å¼•

ã€è´­ä¹°æµç¨‹ã€‘
ç”¨æˆ·æµè§ˆ â†’ æŸ¥çœ‹è¯¦æƒ… â†’ è¯•ç©/æ¼”ç¤º â†’ é€‰æ‹©å¥—é¤ â†’ æ”¯ä»˜ â†’ è·å¾—æˆæƒ â†’ ä¸‹è½½ä½¿ç”¨
   â”‚          â”‚          â”‚          â”‚        â”‚        â”‚
   â–¼          â–¼          â–¼          â–¼        â–¼        â–¼
æ¨èç®—æ³•    è¯„åˆ†è¯„ä»·   åœ¨çº¿ä½“éªŒ   æœˆä»˜/å¹´ä»˜  å¤šæ¸ é“   è®¾å¤‡ç»‘å®š   è‡ªåŠ¨åŒæ­¥
åˆ†ç±»ç­›é€‰    ä½¿ç”¨æ–‡æ¡£   é™åˆ¶åŠŸèƒ½   ä¹°æ–­åˆ¶    æ”¯ä»˜     æˆæƒéªŒè¯

ã€ç»“ç®—æµç¨‹ã€‘
ç”¨æˆ·ä»˜æ¬¾ â†’ å¹³å°æ‰˜ç®¡ â†’ ç¡®è®¤æ”¶è´§(7å¤©) â†’ å¼€å‘è€…æç° â†’ ç»“ç®—å®Œæˆ
   â”‚          â”‚           â”‚            â”‚
   â–¼          â–¼           â–¼            â–¼
æ”¯ä»˜ç½‘å…³   èµ„é‡‘å†»ç»“    è‡ªåŠ¨ç¡®è®¤    T+7ç»“ç®—
æ‰‹ç»­è´¹      äº‰è®®æœŸ      å¥½è¯„å¥–åŠ±    ç¨è´¹ä»£æ‰£
```

### 7.6 äº¤æ˜“å®‰å…¨ä¸é£æ§

```typescript
// äº¤æ˜“é£æ§é…ç½®
interface TransactionRiskControl {
  // ä¹°å®¶ä¿æŠ¤
  buyer_protection: {
    // 7å¤©æ— ç†ç”±é€€æ¬¾ï¼ˆç¬¦åˆæ¡ä»¶ï¼‰
    refund_window_days: 7;

    // è‡ªåŠ¨ç¡®è®¤æ—¶é—´
    auto_confirm_days: 7;

    // äº‰è®®å¤„ç†
    dispute_window_days: 30;

    // è´¨é‡é—®é¢˜é€€æ¬¾
    quality_guarantee: boolean;
  };

  // å–å®¶ä¿æŠ¤
  seller_protection: {
    // æç°é—¨æ§›
    min_withdrawal_amount: 10000;  // 100å…ƒ

    // ç»“ç®—å‘¨æœŸ
    settlement_days: 7;

    // æ¬ºè¯ˆæ£€æµ‹
    fraud_detection: boolean;
  };

  // åæ¬ºè¯ˆè§„åˆ™
  antifraud_rules: {
    // åŒä¸€è®¾å¤‡è´­ä¹°é™åˆ¶
    max_purchases_per_device: 10;

    // å¼‚å¸¸äº¤æ˜“æ£€æµ‹
    velocity_check: {
      max_transactions_per_hour: 5;
      max_amount_per_day: 100000;  // 1000å…ƒ
    };

    // é«˜é£é™©åœ°åŒºé™åˆ¶
    geo_restrictions: string[];

    // é€€æ¬¾ç‡ç›‘æ§
    max_refund_rate: 0.3;  // 30%
  };
}

// äº¤æ˜“å®‰å…¨æœåŠ¡
class TransactionSecurity {
  // éªŒè¯è´­ä¹°åˆæ³•æ€§
  async validatePurchase(
    userId: string,
    skillId: string,
    amount: number
  ): Promise<ValidationResult> {
    const checks = await Promise.all([
      this.checkUserStatus(userId),
      this.checkDeviceLimit(userId),
      this.checkVelocityLimit(userId, amount),
      this.checkSkillStatus(skillId),
      this.checkPriceIntegrity(skillId, amount)
    ]);

    const failed = checks.filter(c => !c.passed);

    if (failed.length > 0) {
      return {
        valid: false,
        reasons: failed.map(f => f.reason)
      };
    }

    return { valid: true };
  }

  // åæ´—é’±æ£€æŸ¥
  async amlCheck(userId: string, amount: number): Promise<AMLResult> {
    // å¤§é¢äº¤æ˜“æŠ¥å‘Š
    if (amount > 100000) {  // 1000å…ƒ
      await this.reportLargeTransaction(userId, amount);
    }

    // å¯ç–‘äº¤æ˜“æ£€æµ‹
    const pattern = await this.analyzeTransactionPattern(userId);
    if (pattern.risk_score > 0.8) {
      await this.flagForReview(userId, pattern);
    }

    return { cleared: pattern.risk_score < 0.5 };
  }
}
```

---

## 8. éƒ¨ç½²ä¸è¿ç»´

### 8.1 éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Skills é›†æˆéƒ¨ç½²æ¶æ„                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      ç”Ÿäº§ç¯å¢ƒ (Production)                       â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚   Nginx      â”‚  â”‚  Skill API   â”‚  â”‚  Sync Worker â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   (LB)       â”‚  â”‚   Server     â”‚  â”‚              â”‚          â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚  (x3)        â”‚  â”‚  (x2)        â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚         â”‚                 â”‚                 â”‚                   â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â”‚                           â”‚                                      â”‚   â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                              â”‚   â”‚
â”‚  â”‚                    â”‚  PostgreSQL â”‚                              â”‚   â”‚
â”‚  â”‚                    â”‚  (Primary)  â”‚                              â”‚   â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚    Redis     â”‚  â”‚   RabbitMQ   â”‚  â”‚    MinIO     â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   (Cache)    â”‚  â”‚    (Queue)   â”‚  â”‚  (Storage)   â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      æ²™ç®±ç¯å¢ƒ (Sandbox)                          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚              Kubernetes Cluster                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Skill Pod 1  â”‚  â”‚ Skill Pod 2  â”‚  â”‚ Skill Pod N  â”‚  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ (éš”ç¦»å®¹å™¨)    â”‚  â”‚ (éš”ç¦»å®¹å™¨)    â”‚  â”‚ (éš”ç¦»å®¹å™¨)    â”‚  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Resource Quota: CPU 32 cores / Memory 64GB              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Network Policy: Deny All, Allow Explicit                â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ç›‘æ§å‘Šè­¦

```yaml
# ============================================
# ç›‘æ§å‘Šè­¦é…ç½®
# ============================================

# å…³é”®æŒ‡æ ‡ç›‘æ§
metrics:
  # åŒæ­¥æŒ‡æ ‡
  sync:
    - name: sync_latency
      threshold: 5000ms
      severity: warning
    - name: sync_failure_rate
      threshold: 5%
      severity: critical
    - name: sync_queue_size
      threshold: 1000
      severity: warning

  # æ‰§è¡ŒæŒ‡æ ‡
  execution:
    - name: execution_duration
      threshold: 300s
      severity: warning
    - name: execution_failure_rate
      threshold: 10%
      severity: critical
    - name: sandbox_resource_usage
      threshold: 80%
      severity: warning

  # ç³»ç»ŸæŒ‡æ ‡
  system:
    - name: api_response_time
      threshold: 1000ms
      severity: warning
    - name: error_rate
      threshold: 1%
      severity: critical
    - name: database_connection_pool
      threshold: 80%
      severity: warning

# å‘Šè­¦æ¸ é“
alerts:
  channels:
    - type: email
      recipients: ["ops@sillymd.com"]
    - type: slack
      webhook: "https://hooks.slack.com/xxx"
    - type: sms
      phone_numbers: ["+86xxx"]
      for_severity: [critical]
```

### 8.3 æ•…éšœå¤„ç†

| æ•…éšœåœºæ™¯ | æ£€æµ‹æ–¹å¼ | è‡ªåŠ¨å¤„ç† | äººå·¥ä»‹å…¥ |
|---------|---------|---------|---------|
| åŒæ­¥å¤±è´¥ | å¤±è´¥ç‡ç›‘æ§ | é‡è¯•3æ¬¡ï¼Œé™çº§åˆ°è½®è¯¢ | è¶…è¿‡10åˆ†é’Ÿå‘Šè­¦ |
| æ²™ç®±OOM | èµ„æºç›‘æ§ | è‡ªåŠ¨æ€æ­»ï¼Œè¿”å›é”™è¯¯ | è®°å½•æ—¥å¿—åˆ†æ |
| æ‰§è¡Œè¶…æ—¶ | è¶…æ—¶ç›‘æ§ | å¼ºåˆ¶ç»ˆæ­¢ | è®°å½•ç°åœº |
| APIå¼‚å¸¸ | å“åº”æ—¶é—´ç›‘æ§ | ç†”æ–­ï¼Œè¿”å›ç¼“å­˜ | è‡ªåŠ¨æ¢å¤åé€šçŸ¥ |
| æ•°æ®åº“æ•…éšœ | è¿æ¥æ± ç›‘æ§ | åˆ‡æ¢åˆ°åªè¯»æ¨¡å¼ | ç«‹å³ä»‹å…¥ |

---

## é™„å½•

### A. é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | è¯´æ˜ | å¤„ç†å»ºè®® |
|-------|------|---------|
| 4001 | Skill ä¸å­˜åœ¨ | æ£€æŸ¥ skill_id æ˜¯å¦æ­£ç¡® |
| 4002 | Skill ç‰ˆæœ¬ä¸å…¼å®¹ | æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ |
| 4003 | è¾“å…¥å‚æ•°æ— æ•ˆ | æ£€æŸ¥å‚æ•°æ ¼å¼å’Œç±»å‹ |
| 4004 | æƒé™ä¸è¶³ | ç”³è¯·æ‰€éœ€æƒé™ |
| 5001 | æ‰§è¡Œè¶…æ—¶ | å¢åŠ è¶…æ—¶æ—¶é—´æˆ–ä¼˜åŒ–ä»£ç  |
| 5002 | å†…å­˜æº¢å‡º | å‡å°‘å†…å­˜ä½¿ç”¨æˆ–ç”³è¯·æ›´å¤§é…é¢ |
| 5003 | æ²™ç®±é”™è¯¯ | æ£€æŸ¥ä»£ç å®‰å…¨æ€§ |
| 6001 | åŒæ­¥å†²çª | æ‰‹åŠ¨è§£å†³å†²çª |
| 6002 | ç½‘ç»œé”™è¯¯ | æ£€æŸ¥ç½‘ç»œè¿æ¥ |

### B. ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|-------|------|-------|
| `SKILL_SYNC_INTERVAL` | åŒæ­¥é—´éš”(ç§’) | 300 |
| `SKILL_EXEC_TIMEOUT` | æ‰§è¡Œè¶…æ—¶(ç§’) | 300 |
| `SKILL_SANDBOX_MEMORY` | æ²™ç®±å†…å­˜é™åˆ¶(MB) | 512 |
| `SKILL_SANDBOX_CPU` | æ²™ç®±CPUé™åˆ¶ | 1.0 |
| `SKILL_CACHE_TTL` | ç¼“å­˜æ—¶é—´(ç§’) | 3600 |

### C. ç›¸å…³æ–‡æ¡£

- [Skills åˆ†ç±»ä½“ç³»](/docs/04-skills-system.md)
- [Skills ç¼–è¾‘å™¨](/docs/16-skills-editor.md)
- [å‰ç«¯è®¾è®¡è§„èŒƒ](/docs/15-frontend.md)
- [API å‚è€ƒæ–‡æ¡£](/docs/28-api-reference.md)
